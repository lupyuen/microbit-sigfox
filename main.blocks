<xml xmlns="http://www.w3.org/1999/xhtml">↵  <variables>↵    <variable type="" id="[`2t-(:Z)n~n-gDDj[6Q">sensorData</variable>↵    <variable type="" id="aK9Izgf;bZZm~HK!TwCc">MAX_SENSOR_COUNT</variable>↵    <variable type="" id="p4#K7VFf6A@_IR8Rz^sC">sensor</variable>↵    <variable type="" id="@qP4E^}CM5X#M4o0Q%8I">MAX_PORT_COUNT</variable>↵    <variable type="" id=":z#WeWNEUdNbb.87B?Q+">MAX_UART_SEND_MSG_SIZE</variable>↵    <variable type="" id="L]TxfhaRmA~Yd{Q~Gb?]">MAX_UART_RESPONSE_MSG_SIZE</variable>↵    <variable type="" id="{AzfZq9yaa3eyqkcm7%#">ENABLE_DOWNLINK</variable>↵    <variable type="" id="X:AAsMFl`,Z.(#(9YldV">SEND_INTERVAL</variable>↵    <variable type="" id="Q-%VQI1Q@l^*;l44dH|?">MAX_SENSOR_DATA_SIZE</variable>↵    <variable type="" id="1=n+[%`(,k0U=B:Z~,AV">MAX_SENSOR_NAME_SIZE</variable>↵    <variable type="" id="nQIw_$joqZ~XO%4T$[OC">BEGIN_SENSOR_NAME</variable>↵    <variable type="" id="Y*w{[S%FFr5ITBDQpD`4">RESPONSE_SENSOR_NAME</variable>↵    <variable type="" id="*i-[p9TL|E,rftZohOjz">SENSOR_NOT_READY</variable>↵    <variable type="" id="Ega,{DoGl|],gYg7BdV3">MAX_NETWORK_CMD_LIST_SIZE</variable>↵    <variable type="" id="554bG)x0[vNBmdtc%$tX">MAX_DEVICE_ID_SIZE</variable>↵    <variable type="" id="vyT73)Bq}avs0+-^CqvL">MAX_DEVICE_CODE_SIZE</variable>↵    <variable type="" id="@3653$8`ouBkRFm^?:`!">MAX_MESSAGE_SIZE</variable>↵    <variable type="" id="h287V$WC1~,ga9Y3KK@h">SEND_DELAY</variable>↵    <variable type="" id="(j~?Q~j^WC~3QZfk2$T8">COMMAND_TIMEOUT</variable>↵    <variable type="" id="e^DAEZ+`nYpLZK6Hq8qu">UPLINK_TIMEOUT</variable>↵    <variable type="" id="mE-p%2^{jieF0dJ.77ZH">DOWNLINK_TIMEOUT</variable>↵    <variable type="" id="7:}9*T#|IzJ9=*cVD2X`">MAX_TIMEOUT</variable>↵    <variable type="" id="%/eQmpx(?(3v1l@Q%y7~">CMD_NONE</variable>↵    <variable type="" id="U~oM!WN3r@y=Su6R8e;W">CMD_OUTPUT_POWER_MAX</variable>↵    <variable type="" id="cn.3w0O!NC!d$*aK%~re">CMD_GET_CHANNEL</variable>↵    <variable type="" id="va_BfuYFtB`i0y-8-E~O">CMD_RESET_CHANNEL</variable>↵    <variable type="" id="*{Mc?;um0J[5#sBJT~:?">CMD_SEND_MESSAGE</variable>↵    <variable type="" id="rIFpL!tP?N,tIsLWsVAW">CMD_SEND_MESSAGE_RESPONSE</variable>↵    <variable type="" id="oweKg~rL6!J{A%=eN6.f">CMD_GET_ID</variable>↵    <variable type="" id="5~3?P)To#}_B}[*oDTzi">CMD_GET_PAC</variable>↵    <variable type="" id="v[*/17pm7Vc6N*%bT]y7">CMD_EMULATOR_DISABLE</variable>↵    <variable type="" id="iBC(,|=73Hf|,!MG`/l?">CMD_EMULATOR_ENABLE</variable>↵    <variable type="" id="ww%Z^66cWiXBs7j)FOGK">PAYLOAD_SIZE</variable>↵  </variables>↵  <block type="pxt-on-start" x="0" y="0">↵    <statement name="HANDLER">↵      <block type="typescript_statement" editable="false">↵        <mutation line0="let RESPONSE_SENSOR_NAME = &quot;&quot;" numlines="1" declaredvars="RESPONSE_SENSOR_NAME"></mutation>↵        <field name="LINE0">let RESPONSE_SENSOR_NAME = ""</field>↵        <next>↵          <block type="typescript_statement" editable="false">↵            <mutation line0="let MAX_TIMEOUT = 0" numlines="1" declaredvars="MAX_TIMEOUT"></mutation>↵            <field name="LINE0">let MAX_TIMEOUT = 0</field>↵            <next>↵              <block type="typescript_statement" editable="false">↵                <mutation line0="let ENABLE_DOWNLINK = false" numlines="1" declaredvars="ENABLE_DOWNLINK"></mutation>↵                <field name="LINE0">let ENABLE_DOWNLINK = false</field>↵                <next>↵                  <block type="typescript_statement" editable="false">↵                    <mutation line0="let MAX_SENSOR_COUNT = 0" numlines="1" declaredvars="MAX_SENSOR_COUNT"></mutation>↵                    <field name="LINE0">let MAX_SENSOR_COUNT = 0</field>↵                    <next>↵                      <block type="typescript_statement" editable="false">↵                        <mutation line0="let cmdList: NetworkCmd[] = []" numlines="1" declaredvars="cmdList"></mutation>↵                        <field name="LINE0">let cmdList: NetworkCmd[] = []</field>↵                        <next>↵                          <block type="typescript_statement" editable="false">↵                            <mutation line0="let msg: SensorMsg = null" numlines="1" declaredvars="msg"></mutation>↵                            <field name="LINE0">let msg: SensorMsg = null</field>↵                            <next>↵                              <block type="typescript_statement" editable="false">↵                                <mutation line0="let responseMsg: SensorMsg = null" numlines="1" declaredvars="responseMsg"></mutation>↵                                <field name="LINE0">let responseMsg: SensorMsg = null</field>↵                                <next>↵                                  <block type="typescript_statement" editable="false">↵                                    <mutation line0="let uartMsg: UARTMsg = null" numlines="1" declaredvars="uartMsg"></mutation>↵                                    <field name="LINE0">let uartMsg: UARTMsg = null</field>↵                                    <next>↵                                      <block type="typescript_statement" editable="false">↵                                        <mutation line0="let MAX_UART_SEND_MSG_SIZE = 0" numlines="1" declaredvars="MAX_UART_SEND_MSG_SIZE"></mutation>↵                                        <field name="LINE0">let MAX_UART_SEND_MSG_SIZE = 0</field>↵                                        <next>↵                                          <block type="typescript_statement" editable="false">↵                                            <mutation line0="let SEND_INTERVAL = 0" numlines="1" declaredvars="SEND_INTERVAL"></mutation>↵                                            <field name="LINE0">let SEND_INTERVAL = 0</field>↵                                            <next>↵                                              <block type="typescript_statement" editable="false">↵                                                <mutation line0="let MAX_NETWORK_CMD_LIST_SIZE = 0" numlines="1" declaredvars="MAX_NETWORK_CMD_LIST_SIZE"></mutation>↵                                                <field name="LINE0">let MAX_NETWORK_CMD_LIST_SIZE = 0</field>↵                                                <next>↵                                                  <block type="typescript_statement" editable="false">↵                                                    <mutation line0="let COMMAND_TIMEOUT = 0" numlines="1" declaredvars="COMMAND_TIMEOUT"></mutation>↵                                                    <field name="LINE0">let COMMAND_TIMEOUT = 0</field>↵                                                    <next>↵                                                      <block type="typescript_statement" editable="false">↵                                                        <mutation line0="let UPLINK_TIMEOUT = 0" numlines="1" declaredvars="UPLINK_TIMEOUT"></mutation>↵                                                        <field name="LINE0">let UPLINK_TIMEOUT = 0</field>↵                                                        <next>↵                                                          <block type="typescript_statement" editable="false">↵                                                            <mutation line0="let DOWNLINK_TIMEOUT = 0" numlines="1" declaredvars="DOWNLINK_TIMEOUT"></mutation>↵                                                            <field name="LINE0">let DOWNLINK_TIMEOUT = 0</field>↵                                                            <next>↵                                                              <block type="typescript_statement" editable="false">↵                                                                <mutation line0="let CMD_NONE = &quot;&quot;" numlines="1" declaredvars="CMD_NONE"></mutation>↵                                                                <field name="LINE0">let CMD_NONE = ""</field>↵                                                                <next>↵                                                                  <block type="typescript_statement" editable="false">↵                                                                    <mutation line0="let CMD_OUTPUT_POWER_MAX = &quot;&quot;" numlines="1" declaredvars="CMD_OUTPUT_POWER_MAX"></mutation>↵                                                                    <field name="LINE0">let CMD_OUTPUT_POWER_MAX = ""</field>↵                                                                    <next>↵                                                                      <block type="typescript_statement" editable="false">↵                                                                        <mutation line0="let CMD_GET_CHANNEL = &quot;&quot;" numlines="1" declaredvars="CMD_GET_CHANNEL"></mutation>↵                                                                        <field name="LINE0">let CMD_GET_CHANNEL = ""</field>↵                                                                        <next>↵                                                                          <block type="typescript_statement" editable="false">↵                                                                            <mutation line0="let CMD_RESET_CHANNEL = &quot;&quot;" numlines="1" declaredvars="CMD_RESET_CHANNEL"></mutation>↵                                                                            <field name="LINE0">let CMD_RESET_CHANNEL = ""</field>↵                                                                            <next>↵                                                                              <block type="typescript_statement" editable="false">↵                                                                                <mutation line0="let CMD_SEND_MESSAGE = &quot;&quot;" numlines="1" declaredvars="CMD_SEND_MESSAGE"></mutation>↵                                                                                <field name="LINE0">let CMD_SEND_MESSAGE = ""</field>↵                                                                                <next>↵                                                                                  <block type="typescript_statement" editable="false">↵                                                                                    <mutation line0="let CMD_SEND_MESSAGE_RESPONSE = &quot;&quot;" numlines="1" declaredvars="CMD_SEND_MESSAGE_RESPONSE"></mutation>↵                                                                                    <field name="LINE0">let CMD_SEND_MESSAGE_RESPONSE = ""</field>↵                                                                                    <next>↵                                                                                      <block type="typescript_statement" editable="false">↵                                                                                        <mutation line0="let CMD_GET_ID = &quot;&quot;" numlines="1" declaredvars="CMD_GET_ID"></mutation>↵                                                                                        <field name="LINE0">let CMD_GET_ID = ""</field>↵                                                                                        <next>↵                                                                                          <block type="typescript_statement" editable="false">↵                                                                                            <mutation line0="let CMD_GET_PAC = &quot;&quot;" numlines="1" declaredvars="CMD_GET_PAC"></mutation>↵                                                                                            <field name="LINE0">let CMD_GET_PAC = ""</field>↵                                                                                            <next>↵                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                <mutation line0="let CMD_EMULATOR_DISABLE = &quot;&quot;" numlines="1" declaredvars="CMD_EMULATOR_DISABLE"></mutation>↵                                                                                                <field name="LINE0">let CMD_EMULATOR_DISABLE = ""</field>↵                                                                                                <next>↵                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                    <mutation line0="let CMD_EMULATOR_ENABLE = &quot;&quot;" numlines="1" declaredvars="CMD_EMULATOR_ENABLE"></mutation>↵                                                                                                    <field name="LINE0">let CMD_EMULATOR_ENABLE = ""</field>↵                                                                                                    <next>↵                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                        <mutation line0="let sensorData: SensorMsg[] = []" numlines="1" declaredvars="sensorData"></mutation>↵                                                                                                        <field name="LINE0">let sensorData: SensorMsg[] = []</field>↵                                                                                                        <next>↵                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                            <mutation line0="let payload: string = null" numlines="1" declaredvars="payload"></mutation>↵                                                                                                            <field name="LINE0">let payload: string = null</field>↵                                                                                                            <next>↵                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                <mutation line0="let BEGIN_SENSOR_NAME = &quot;&quot;" numlines="1" declaredvars="BEGIN_SENSOR_NAME"></mutation>↵                                                                                                                <field name="LINE0">let BEGIN_SENSOR_NAME = ""</field>↵                                                                                                                <next>↵                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                    <mutation line0="let PAYLOAD_SIZE = 0" numlines="1" declaredvars="PAYLOAD_SIZE"></mutation>↵                                                                                                                    <field name="LINE0">let PAYLOAD_SIZE = 0</field>↵                                                                                                                    <next>↵                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                        <mutation line0="let successEvent: Evt_t = null" numlines="1" declaredvars="successEvent"></mutation>↵                                                                                                                        <field name="LINE0">let successEvent: Evt_t = null</field>↵                                                                                                                        <next>↵                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                            <mutation line0="let failureEvent: Evt_t = null" numlines="1" declaredvars="failureEvent"></mutation>↵                                                                                                                            <field name="LINE0">let failureEvent: Evt_t = null</field>↵                                                                                                                            <next>↵                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                <mutation line0="let uartResponse: string = null" numlines="1" declaredvars="uartResponse"></mutation>↵                                                                                                                                <field name="LINE0">let uartResponse: string = null</field>↵                                                                                                                                <next>↵                                                                                                                                  <block type="serial_redirect">↵                                                                                                                                    <field name="tx">SerialPin.P0</field>↵                                                                                                                                    <field name="rx">SerialPin.P1</field>↵                                                                                                                                    <field name="rate">BaudRate.BaudRate9600</field>↵                                                                                                                                    <next>↵                                                                                                                                      <block type="variables_set">↵                                                                                                                                        <field name="VAR" id="aK9Izgf;bZZm~HK!TwCc" variabletype="">MAX_SENSOR_COUNT</field>↵                                                                                                                                        <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From platform.h</comment>↵                                                                                                                                        <value name="VALUE">↵                                                                                                                                          <shadow type="math_number">↵                                                                                                                                            <field name="NUM">3</field>↵                                                                                                                                          </shadow>↵                                                                                                                                        </value>↵                                                                                                                                        <next>↵                                                                                                                                          <block type="variables_set">↵                                                                                                                                            <field name="VAR" id="@qP4E^}CM5X#M4o0Q%8I" variabletype="">MAX_PORT_COUNT</field>↵                                                                                                                                            <value name="VALUE">↵                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                <field name="NUM">4</field>↵                                                                                                                                              </shadow>↵                                                                                                                                            </value>↵                                                                                                                                            <next>↵                                                                                                                                              <block type="variables_set">↵                                                                                                                                                <field name="VAR" id=":z#WeWNEUdNbb.87B?Q+" variabletype="">MAX_UART_SEND_MSG_SIZE</field>↵                                                                                                                                                <value name="VALUE">↵                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                    <field name="NUM">35</field>↵                                                                                                                                                  </shadow>↵                                                                                                                                                </value>↵                                                                                                                                                <next>↵                                                                                                                                                  <block type="variables_set">↵                                                                                                                                                    <field name="VAR" id="L]TxfhaRmA~Yd{Q~Gb?]" variabletype="">MAX_UART_RESPONSE_MSG_SIZE</field>↵                                                                                                                                                    <value name="VALUE">↵                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                        <field name="NUM">36</field>↵                                                                                                                                                      </shadow>↵                                                                                                                                                    </value>↵                                                                                                                                                    <next>↵                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                        <field name="VAR" id="{AzfZq9yaa3eyqkcm7%#" variabletype="">ENABLE_DOWNLINK</field>↵                                                                                                                                                        <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From aggregate.h const ENABLE_DOWNLINK = false  // Uplink data only</comment>↵                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                          </shadow>↵                                                                                                                                                          <block type="logic_boolean">↵                                                                                                                                                            <field name="BOOL">TRUE</field>↵                                                                                                                                                          </block>↵                                                                                                                                                        </value>↵                                                                                                                                                        <next>↵                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                            <field name="VAR" id="X:AAsMFl`,Z.(#(9YldV" variabletype="">SEND_INTERVAL</field>↵                                                                                                                                                            <comment pinned="false" h="120" w="160">Send a message to network every 20,000 milliseconds = 20 seconds.</comment>↵                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                              </shadow>↵                                                                                                                                                              <block type="math_arithmetic">↵                                                                                                                                                                <field name="OP">MULTIPLY</field>↵                                                                                                                                                                <value name="A">↵                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                    <field name="NUM">20</field>↵                                                                                                                                                                  </shadow>↵                                                                                                                                                                </value>↵                                                                                                                                                                <value name="B">↵                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                    <field name="NUM">1000</field>↵                                                                                                                                                                  </shadow>↵                                                                                                                                                                </value>↵                                                                                                                                                              </block>↵                                                                                                                                                            </value>↵                                                                                                                                                            <next>↵                                                                                                                                                              <block type="variables_set">↵                                                                                                                                                                <field name="VAR" id="Q-%VQI1Q@l^*;l44dH|?" variabletype="">MAX_SENSOR_DATA_SIZE</field>↵                                                                                                                                                                <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From sensor.h</comment>↵                                                                                                                                                                <value name="VALUE">↵                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                    <field name="NUM">3</field>↵                                                                                                                                                                  </shadow>↵                                                                                                                                                                </value>↵                                                                                                                                                                <next>↵                                                                                                                                                                  <block type="variables_set">↵                                                                                                                                                                    <field name="VAR" id="1=n+[%`(,k0U=B:Z~,AV" variabletype="">MAX_SENSOR_NAME_SIZE</field>↵                                                                                                                                                                    <value name="VALUE">↵                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                        <field name="NUM">3</field>↵                                                                                                                                                                      </shadow>↵                                                                                                                                                                    </value>↵                                                                                                                                                                    <next>↵                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                        <field name="VAR" id="nQIw_$joqZ~XO%4T$[OC" variabletype="">BEGIN_SENSOR_NAME</field>↵                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                                          </shadow>↵                                                                                                                                                                          <block type="text">↵                                                                                                                                                                            <field name="TEXT">000</field>↵                                                                                                                                                                          </block>↵                                                                                                                                                                        </value>↵                                                                                                                                                                        <next>↵                                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                                            <field name="VAR" id="Y*w{[S%FFr5ITBDQpD`4" variabletype="">RESPONSE_SENSOR_NAME</field>↵                                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                                              </shadow>↵                                                                                                                                                                              <block type="text">↵                                                                                                                                                                                <field name="TEXT">RES</field>↵                                                                                                                                                                              </block>↵                                                                                                                                                                            </value>↵                                                                                                                                                                            <next>↵                                                                                                                                                                              <block type="variables_set">↵                                                                                                                                                                                <field name="VAR" id="*i-[p9TL|E,rftZohOjz" variabletype="">SENSOR_NOT_READY</field>↵                                                                                                                                                                                <value name="VALUE">↵                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                    <field name="NUM">255</field>↵                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                </value>↵                                                                                                                                                                                <next>↵                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                    <mutation line0="interface SensorMsg {" line1="    // Msg_t super; //  Required for all cocoOS messages." line2="    name: string;   //  3-character name of sensor e.g. tmp, hmd. Includes terminating null." line3="    data: number[]; //  Array of float sensor data values returned by the sensor." line4="    count: uint8;        //  Number of float sensor data values returned by the sensor." line5="}" numlines="6"></mutation>↵                                                                                                                                                                                    <field name="LINE0">interface SensorMsg {</field>↵                                                                                                                                                                                    <field name="LINE1">    // Msg_t super; //  Required for all cocoOS messages.</field>↵                                                                                                                                                                                    <field name="LINE2">    name: string;   //  3-character name of sensor e.g. tmp, hmd. Includes terminating null.</field>↵                                                                                                                                                                                    <field name="LINE3">    data: number[]; //  Array of float sensor data values returned by the sensor.</field>↵                                                                                                                                                                                    <field name="LINE4">    count: uint8;        //  Number of float sensor data values returned by the sensor.</field>↵                                                                                                                                                                                    <field name="LINE5">}</field>↵                                                                                                                                                                                    <comment pinned="false" h="120" w="160">Messages sent by Sensor Task containing sensor data will be in this format.</comment>↵                                                                                                                                                                                    <next>↵                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                        <field name="VAR" id="Ega,{DoGl|],gYg7BdV3" variabletype="">MAX_NETWORK_CMD_LIST_SIZE</field>↵                                                                                                                                                                                        <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From wisol.h</comment>↵                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                            <field name="NUM">5</field>↵                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                        </value>↵                                                                                                                                                                                        <next>↵                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                            <mutation line0="interface NetworkCmd {" line1="    sendData: string;  //  Command string to be sent, in F() flash memory. " line2="    expectedMarkerCount: uint8;  //  Wait for this number of markers until timeout." line3="    payload: string;  //  Additional payload to be sent right after sendData. Note: This is a pointer, not a buffer." line4="    sendData2: string;  //  Second command string to be sent, in F() flash memory. " line5="    processFunc: (context: NetworkContext, response: string) =&gt; boolean;  //  Function to process the response, NULL if none." line6="}" numlines="7"></mutation>↵                                                                                                                                                                                            <field name="LINE0">interface NetworkCmd {</field>↵                                                                                                                                                                                            <field name="LINE1">    sendData: string;  //  Command string to be sent, in F() flash memory. </field>↵                                                                                                                                                                                            <field name="LINE2">    expectedMarkerCount: uint8;  //  Wait for this number of markers until timeout.</field>↵                                                                                                                                                                                            <field name="LINE3">    payload: string;  //  Additional payload to be sent right after sendData. Note: This is a pointer, not a buffer.</field>↵                                                                                                                                                                                            <field name="LINE4">    sendData2: string;  //  Second command string to be sent, in F() flash memory. </field>↵                                                                                                                                                                                            <field name="LINE5">    processFunc: (context: NetworkContext, response: string) =&gt; boolean;  //  Function to process the response, NULL if none.</field>↵                                                                                                                                                                                            <field name="LINE6">}</field>↵                                                                                                                                                                                            <comment pinned="false" h="120" w="160">Defines a Wisol AT command string, to be sent via UART Task. Sequence is sendData + payload + sendData2</comment>↵                                                                                                                                                                                            <next>↵                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                <mutation line0="interface NetworkContext {" line1="    uartContext: UARTContext;  //  Context of the UART Task." line2="    uartTaskID: uint8;  //  Task ID of the UART Task.  Network Task transmits UART data by sending a message to this task." line3="    zone: number;  //  1 to 4 representing SIGFOX frequencies RCZ 1 to 4." line4="    country: Country;   //  Country to be set for SIGFOX transmission frequencies." line5="    useEmulator: boolean;  //  Set to true if using SNEK Emulator." line6="    stepBeginFunc: (  //  Begin Step: Return the Wisol AT Commands to be executed at startup." line7="        context: NetworkContext," line8="        args: StepArgs) =&gt; void;" line9="    stepSendFunc: (  //  Send Step: Return the Wisol AT Commands to be executed when sending a payload." line10="        context: NetworkContext," line11="        args: StepArgs) =&gt; void;" line12="" line13="    device: string;  //  Sigfox device ID read from device e.g. 002C2EA1" line14="    pac: string;  //  Sigfox PAC code read from device e.g. 5BEB8CF64E869BD1" line15="    status: boolean;  //  Return status.  True if command was successful." line16="    pendingResponse: boolean;  //  True if we are waiting for the send response to be processed." line17="    pendingProcessFunc: (context: NetworkContext, response: string) =&gt; boolean;  //  Function to process the pending response, NULL if none." line18="    lastSend: number;  //  Timestamp of last sent message in milliseconds.  Used for throttling." line19="    msg: SensorMsg;  //  Sensor data being sent. Set by network_task() upon receiving a message." line20="    downlinkData: string;  //  If downlink was requested, set the downlink hex string e.g. 0102030405060708." line21="" line22="    cmdList: NetworkCmd[];  //  List of Wisol AT commands being sent." line23="    cmdIndex: number;  //  Index of cmdList being sent." line24="}" numlines="25"></mutation>↵                                                                                                                                                                                                <field name="LINE0">interface NetworkContext {</field>↵                                                                                                                                                                                                <field name="LINE1">    uartContext: UARTContext;  //  Context of the UART Task.</field>↵                                                                                                                                                                                                <field name="LINE2">    uartTaskID: uint8;  //  Task ID of the UART Task.  Network Task transmits UART data by sending a message to this task.</field>↵                                                                                                                                                                                                <field name="LINE3">    zone: number;  //  1 to 4 representing SIGFOX frequencies RCZ 1 to 4.</field>↵                                                                                                                                                                                                <field name="LINE4">    country: Country;   //  Country to be set for SIGFOX transmission frequencies.</field>↵                                                                                                                                                                                                <field name="LINE5">    useEmulator: boolean;  //  Set to true if using SNEK Emulator.</field>↵                                                                                                                                                                                                <field name="LINE6">    stepBeginFunc: (  //  Begin Step: Return the Wisol AT Commands to be executed at startup.</field>↵                                                                                                                                                                                                <field name="LINE7">        context: NetworkContext,</field>↵                                                                                                                                                                                                <field name="LINE8">        args: StepArgs) =&gt; void;</field>↵                                                                                                                                                                                                <field name="LINE9">    stepSendFunc: (  //  Send Step: Return the Wisol AT Commands to be executed when sending a payload.</field>↵                                                                                                                                                                                                <field name="LINE10">        context: NetworkContext,</field>↵                                                                                                                                                                                                <field name="LINE11">        args: StepArgs) =&gt; void;</field>↵                                                                                                                                                                                                <field name="LINE12"></field>↵                                                                                                                                                                                                <field name="LINE13">    device: string;  //  Sigfox device ID read from device e.g. 002C2EA1</field>↵                                                                                                                                                                                                <field name="LINE14">    pac: string;  //  Sigfox PAC code read from device e.g. 5BEB8CF64E869BD1</field>↵                                                                                                                                                                                                <field name="LINE15">    status: boolean;  //  Return status.  True if command was successful.</field>↵                                                                                                                                                                                                <field name="LINE16">    pendingResponse: boolean;  //  True if we are waiting for the send response to be processed.</field>↵                                                                                                                                                                                                <field name="LINE17">    pendingProcessFunc: (context: NetworkContext, response: string) =&gt; boolean;  //  Function to process the pending response, NULL if none.</field>↵                                                                                                                                                                                                <field name="LINE18">    lastSend: number;  //  Timestamp of last sent message in milliseconds.  Used for throttling.</field>↵                                                                                                                                                                                                <field name="LINE19">    msg: SensorMsg;  //  Sensor data being sent. Set by network_task() upon receiving a message.</field>↵                                                                                                                                                                                                <field name="LINE20">    downlinkData: string;  //  If downlink was requested, set the downlink hex string e.g. 0102030405060708.</field>↵                                                                                                                                                                                                <field name="LINE21"></field>↵                                                                                                                                                                                                <field name="LINE22">    cmdList: NetworkCmd[];  //  List of Wisol AT commands being sent.</field>↵                                                                                                                                                                                                <field name="LINE23">    cmdIndex: number;  //  Index of cmdList being sent.</field>↵                                                                                                                                                                                                <field name="LINE24">}</field>↵                                                                                                                                                                                                <comment pinned="false" h="120" w="160">Network Task maintains this context in the task data.</comment>↵                                                                                                                                                                                                <next>↵                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                    <mutation line0="interface StepArgs {" line1="    list: NetworkCmd[];" line2="    listSize: number;" line3="    payload: string;" line4="    enableDownlink: boolean;" line5="}" numlines="6"></mutation>↵                                                                                                                                                                                                    <field name="LINE0">interface StepArgs {</field>↵                                                                                                                                                                                                    <field name="LINE1">    list: NetworkCmd[];</field>↵                                                                                                                                                                                                    <field name="LINE2">    listSize: number;</field>↵                                                                                                                                                                                                    <field name="LINE3">    payload: string;</field>↵                                                                                                                                                                                                    <field name="LINE4">    enableDownlink: boolean;</field>↵                                                                                                                                                                                                    <field name="LINE5">}</field>↵                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                        <mutation line0="interface Evt_t {" line1="}" numlines="2"></mutation>↵                                                                                                                                                                                                        <field name="LINE0">interface Evt_t {</field>↵                                                                                                                                                                                                        <field name="LINE1">}</field>↵                                                                                                                                                                                                        <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From uart.h TODO</comment>↵                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                            <mutation line0="interface UARTMsg {" line1="    //  Msg_t super;  //  Required for all cocoOS messages." line2="    sendData: string;  //  Pointer to the string to be sent." line3="    timeout: number;  //  Send timeout in milliseconds." line4="    markerChar: uint8;  //  End-of-command marker character that we should count e.g. '\r'" line5="    expectedMarkerCount: uint8;  //  Wait for this number of markers until timeout." line6="    successEvent: Evt_t;  //  Event to be triggered upon success." line7="    failureEvent: Evt_t;  //  Event to be triggered upon failure." line8="    responseMsg: SensorMsg;  //  If not NULL, then send this response message when the response is completed." line9="    responseTaskID: uint8;  //  Send to this task ID." line10="}" numlines="11"></mutation>↵                                                                                                                                                                                                            <field name="LINE0">interface UARTMsg {</field>↵                                                                                                                                                                                                            <field name="LINE1">    //  Msg_t super;  //  Required for all cocoOS messages.</field>↵                                                                                                                                                                                                            <field name="LINE2">    sendData: string;  //  Pointer to the string to be sent.</field>↵                                                                                                                                                                                                            <field name="LINE3">    timeout: number;  //  Send timeout in milliseconds.</field>↵                                                                                                                                                                                                            <field name="LINE4">    markerChar: uint8;  //  End-of-command marker character that we should count e.g. '\r'</field>↵                                                                                                                                                                                                            <field name="LINE5">    expectedMarkerCount: uint8;  //  Wait for this number of markers until timeout.</field>↵                                                                                                                                                                                                            <field name="LINE6">    successEvent: Evt_t;  //  Event to be triggered upon success.</field>↵                                                                                                                                                                                                            <field name="LINE7">    failureEvent: Evt_t;  //  Event to be triggered upon failure.</field>↵                                                                                                                                                                                                            <field name="LINE8">    responseMsg: SensorMsg;  //  If not NULL, then send this response message when the response is completed.</field>↵                                                                                                                                                                                                            <field name="LINE9">    responseTaskID: uint8;  //  Send to this task ID.</field>↵                                                                                                                                                                                                            <field name="LINE10">}</field>↵                                                                                                                                                                                                            <comment pinned="false" h="120" w="160">UART Task accepts messages of this format for sending data.</comment>↵                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                <mutation line0="interface UARTContext {" line1="    status: boolean;  //  Return status.  True if successfully sent." line2="    sendIndex: number;  //  Index of next char to be sent." line3="    sentTime: number;  //  Timestamp at which we completed sending." line4="    response: string;  //  Pointer to the buffer for writing received response." line5="    actualMarkerCount: uint8;  //  Actual number of markers received." line6="    testTimer: number;  //  For testing timer." line7="    msg: UARTMsg;  //  Message being sent. Set by uart_task() upon receiving a message." line8="}" numlines="9"></mutation>↵                                                                                                                                                                                                                <field name="LINE0">interface UARTContext {</field>↵                                                                                                                                                                                                                <field name="LINE1">    status: boolean;  //  Return status.  True if successfully sent.</field>↵                                                                                                                                                                                                                <field name="LINE2">    sendIndex: number;  //  Index of next char to be sent.</field>↵                                                                                                                                                                                                                <field name="LINE3">    sentTime: number;  //  Timestamp at which we completed sending.</field>↵                                                                                                                                                                                                                <field name="LINE4">    response: string;  //  Pointer to the buffer for writing received response.</field>↵                                                                                                                                                                                                                <field name="LINE5">    actualMarkerCount: uint8;  //  Actual number of markers received.</field>↵                                                                                                                                                                                                                <field name="LINE6">    testTimer: number;  //  For testing timer.</field>↵                                                                                                                                                                                                                <field name="LINE7">    msg: UARTMsg;  //  Message being sent. Set by uart_task() upon receiving a message.</field>↵                                                                                                                                                                                                                <field name="LINE8">}</field>↵                                                                                                                                                                                                                <comment pinned="false" h="120" w="160">UART Task maintains this context in the task data.</comment>↵                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                  <block type="variables_set">↵                                                                                                                                                                                                                    <field name="VAR" id="554bG)x0[vNBmdtc%$tX" variabletype="">MAX_DEVICE_ID_SIZE</field>↵                                                                                                                                                                                                                    <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From sigfox.h</comment>↵                                                                                                                                                                                                                    <value name="VALUE">↵                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                        <field name="NUM">8</field>↵                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                                                        <field name="VAR" id="vyT73)Bq}avs0+-^CqvL" variabletype="">MAX_DEVICE_CODE_SIZE</field>↵                                                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                            <field name="NUM">16</field>↵                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                                                                                            <field name="VAR" id="@3653$8`ouBkRFm^?:`!" variabletype="">MAX_MESSAGE_SIZE</field>↵                                                                                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                <field name="NUM">12</field>↵                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                              <block type="variables_set">↵                                                                                                                                                                                                                                <field name="VAR" id="h287V$WC1~,ga9Y3KK@h" variabletype="">SEND_DELAY</field>↵                                                                                                                                                                                                                                <value name="VALUE">↵                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                    <field name="NUM">0</field>↵                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                  <block type="math_arithmetic">↵                                                                                                                                                                                                                                    <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                    <value name="A">↵                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                        <field name="NUM">0</field>↵                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                      <block type="math_arithmetic">↵                                                                                                                                                                                                                                        <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                        <value name="A">↵                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                            <field name="NUM">10</field>↵                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                        <value name="B">↵                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                            <field name="NUM">60</field>↵                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                    <value name="B">↵                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                        <field name="NUM">1000</field>↵                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                  <block type="variables_set">↵                                                                                                                                                                                                                                    <field name="VAR" id="(j~?Q~j^WC~3QZfk2$T8" variabletype="">COMMAND_TIMEOUT</field>↵                                                                                                                                                                                                                                    <comment pinned="false" h="120" w="160">Define multiple timeouts for better multitasking. Uplink to network is slower than normal commands. Downlink is slowest, up to 1 minute. COMMAND_TIMEOUT &lt; UPLINK_TIMEOUT &lt; DOWNLINK_TIMEOUT</comment>↵                                                                                                                                                                                                                                    <value name="VALUE">↵                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                        <field name="NUM">0</field>↵                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                      <block type="math_arithmetic">↵                                                                                                                                                                                                                                        <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                        <value name="A">↵                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                            <field name="NUM">10</field>↵                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                        <value name="B">↵                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                            <field name="NUM">1000</field>↵                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                                                                        <field name="VAR" id="e^DAEZ+`nYpLZK6Hq8qu" variabletype="">UPLINK_TIMEOUT</field>↵                                                                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                          <block type="math_arithmetic">↵                                                                                                                                                                                                                                            <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                            <value name="A">↵                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                <field name="NUM">20</field>↵                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                            <value name="B">↵                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                <field name="NUM">1000</field>↵                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                                                                                                            <field name="VAR" id="mE-p%2^{jieF0dJ.77ZH" variabletype="">DOWNLINK_TIMEOUT</field>↵                                                                                                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                              <block type="math_arithmetic">↵                                                                                                                                                                                                                                                <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                                <value name="A">↵                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                    <field name="NUM">60</field>↵                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                <value name="B">↵                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                    <field name="NUM">1000</field>↵                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                              <block type="variables_set">↵                                                                                                                                                                                                                                                <field name="VAR" id="7:}9*T#|IzJ9=*cVD2X`" variabletype="">MAX_TIMEOUT</field>↵                                                                                                                                                                                                                                                <value name="VALUE">↵                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                    <field name="NUM">0</field>↵                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                  <block type="variables_get">↵                                                                                                                                                                                                                                                    <field name="VAR" id="mE-p%2^{jieF0dJ.77ZH" variabletype="">DOWNLINK_TIMEOUT</field>↵                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                    <mutation line0="const RCZ_MASK = (3 &lt;&lt; 14)" numlines="1" declaredvars="RCZ_MASK"></mutation>↵                                                                                                                                                                                                                                                    <field name="LINE0">const RCZ_MASK = (3 &lt;&lt; 14)</field>↵                                                                                                                                                                                                                                                    <comment pinned="false" h="120" w="160">Define the countries (ISO ALPHA-2 country code) and frequencies that are supported. Based on https://www.sigfox.com/en/coverage, https://www.st.com/content/ccc/resource/technical/document/user_manual/group0/8d/9a/ea/d7/62/06/43/ce/DM00361540/files/DM00361540.pdf/jcr:content/translations/en.DM00361540.pdf</comment>↵                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                        <mutation line0="const RCZ1 = (0 &lt;&lt; 14)" numlines="1" declaredvars="RCZ1"></mutation>↵                                                                                                                                                                                                                                                        <field name="LINE0">const RCZ1 = (0 &lt;&lt; 14)</field>↵                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                            <mutation line0="const RCZ2 = (1 &lt;&lt; 14)" numlines="1" declaredvars="RCZ2"></mutation>↵                                                                                                                                                                                                                                                            <field name="LINE0">const RCZ2 = (1 &lt;&lt; 14)</field>↵                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                <mutation line0="const RCZ3 = (2 &lt;&lt; 14)" numlines="1" declaredvars="RCZ3"></mutation>↵                                                                                                                                                                                                                                                                <field name="LINE0">const RCZ3 = (2 &lt;&lt; 14)</field>↵                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                    <mutation line0="const RCZ4 = (3 &lt;&lt; 14)" numlines="1" declaredvars="RCZ4"></mutation>↵                                                                                                                                                                                                                                                                    <field name="LINE0">const RCZ4 = (3 &lt;&lt; 14)</field>↵                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                        <mutation line0="enum Country {  //  Bits 0-6: First letter. Bits 7-13: Second letter." line1="    COUNTRY_AR = RCZ4 + 'A'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Argentina: RCZ4" line2="    COUNTRY_AU = RCZ4 + 'A'.charCodeAt(0) + ('U'.charCodeAt(0) &lt;&lt; 7),  //  Australia: RCZ4" line3="    COUNTRY_BE = RCZ1 + 'B'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Belgium: RCZ1" line4="    COUNTRY_BR = RCZ2 + 'B'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Brazil: RCZ2" line5="    COUNTRY_CL = RCZ4 + 'C'.charCodeAt(0) + ('L'.charCodeAt(0) &lt;&lt; 7),  //  Chile: RCZ4" line6="    COUNTRY_CO = RCZ4 + 'C'.charCodeAt(0) + ('O'.charCodeAt(0) &lt;&lt; 7),  //  Colombia: RCZ4" line7="    COUNTRY_CR = RCZ4 + 'C'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Costa Rica: RCZ4" line8="    COUNTRY_HR = RCZ1 + 'H'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Croatia: RCZ1" line9="    COUNTRY_CZ = RCZ1 + 'C'.charCodeAt(0) + ('Z'.charCodeAt(0) &lt;&lt; 7),  //  Czech Republic: RCZ1" line10="    COUNTRY_DK = RCZ1 + 'D'.charCodeAt(0) + ('K'.charCodeAt(0) &lt;&lt; 7),  //  Denmark: RCZ1" line11="    COUNTRY_EC = RCZ4 + 'E'.charCodeAt(0) + ('C'.charCodeAt(0) &lt;&lt; 7),  //  Ecuador: RCZ4" line12="    COUNTRY_SV = RCZ4 + 'S'.charCodeAt(0) + ('V'.charCodeAt(0) &lt;&lt; 7),  //  El Salvador: RCZ4" line13="    COUNTRY_EE = RCZ1 + 'E'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Estonia: RCZ1" line14="    COUNTRY_FI = RCZ1 + 'F'.charCodeAt(0) + ('I'.charCodeAt(0) &lt;&lt; 7),  //  Finland: RCZ1" line15="    COUNTRY_FR = RCZ1 + 'F'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  France: RCZ1" line16="    COUNTRY_GF = RCZ1 + 'G'.charCodeAt(0) + ('F'.charCodeAt(0) &lt;&lt; 7),  //  French Guiana: RCZ1" line17="    COUNTRY_PF = RCZ1 + 'P'.charCodeAt(0) + ('F'.charCodeAt(0) &lt;&lt; 7),  //  French Polynesia: RCZ1" line18="    COUNTRY_DE = RCZ1 + 'D'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Germany: RCZ1" line19="    COUNTRY_GP = RCZ1 + 'G'.charCodeAt(0) + ('P'.charCodeAt(0) &lt;&lt; 7),  //  Guadeloupe: RCZ1" line20="    COUNTRY_HK = RCZ4 + 'H'.charCodeAt(0) + ('K'.charCodeAt(0) &lt;&lt; 7),  //  Hong Kong: RCZ4" line21="    COUNTRY_HU = RCZ1 + 'H'.charCodeAt(0) + ('U'.charCodeAt(0) &lt;&lt; 7),  //  Hungary: RCZ1" line22="    COUNTRY_IR = RCZ1 + 'I'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Iran: RCZ1" line23="    COUNTRY_IE = RCZ1 + 'I'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Ireland: RCZ1" line24="    COUNTRY_IT = RCZ1 + 'I'.charCodeAt(0) + ('T'.charCodeAt(0) &lt;&lt; 7),  //  Italy: RCZ1" line25="    COUNTRY_JP = RCZ3 + 'J'.charCodeAt(0) + ('P'.charCodeAt(0) &lt;&lt; 7),  //  Japan: RCZ3" line26="    COUNTRY_LU = RCZ1 + 'L'.charCodeAt(0) + ('U'.charCodeAt(0) &lt;&lt; 7),  //  Luxembourg: RCZ1" line27="    COUNTRY_MY = RCZ4 + 'M'.charCodeAt(0) + ('Y'.charCodeAt(0) &lt;&lt; 7),  //  Malaysia: RCZ4" line28="    COUNTRY_MT = RCZ1 + 'M'.charCodeAt(0) + ('T'.charCodeAt(0) &lt;&lt; 7),  //  Malta: RCZ1" line29="    COUNTRY_MQ = RCZ1 + 'M'.charCodeAt(0) + ('Q'.charCodeAt(0) &lt;&lt; 7),  //  Martinique: RCZ1" line30="    COUNTRY_MX = RCZ2 + 'M'.charCodeAt(0) + ('X'.charCodeAt(0) &lt;&lt; 7),  //  Mexico: RCZ2" line31="    COUNTRY_NL = RCZ1 + 'N'.charCodeAt(0) + ('L'.charCodeAt(0) &lt;&lt; 7),  //  Netherlands: RCZ1" line32="    COUNTRY_NC = RCZ1 + 'N'.charCodeAt(0) + ('C'.charCodeAt(0) &lt;&lt; 7),  //  New Caledonia: RCZ1" line33="    COUNTRY_NZ = RCZ4 + 'N'.charCodeAt(0) + ('Z'.charCodeAt(0) &lt;&lt; 7),  //  New Zealand: RCZ4" line34="    COUNTRY_OM = RCZ1 + 'O'.charCodeAt(0) + ('M'.charCodeAt(0) &lt;&lt; 7),  //  Oman: RCZ1" line35="    COUNTRY_PA = RCZ4 + 'P'.charCodeAt(0) + ('A'.charCodeAt(0) &lt;&lt; 7),  //  Panama: RCZ4" line36="    COUNTRY_PT = RCZ1 + 'P'.charCodeAt(0) + ('T'.charCodeAt(0) &lt;&lt; 7),  //  Portugal: RCZ1" line37="    COUNTRY_RE = RCZ1 + 'R'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Réunion: RCZ1" line38="    COUNTRY_SG = RCZ4 + 'S'.charCodeAt(0) + ('G'.charCodeAt(0) &lt;&lt; 7),  //  Singapore: RCZ4" line39="    COUNTRY_SK = RCZ1 + 'S'.charCodeAt(0) + ('K'.charCodeAt(0) &lt;&lt; 7),  //  Slovakia: RCZ1" line40="    COUNTRY_ZA = RCZ1 + 'Z'.charCodeAt(0) + ('A'.charCodeAt(0) &lt;&lt; 7),  //  South Africa: RCZ1" line41="    COUNTRY_KR = RCZ3 + 'K'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  South Korea: RCZ3" line42="    COUNTRY_ES = RCZ1 + 'E'.charCodeAt(0) + ('S'.charCodeAt(0) &lt;&lt; 7),  //  Spain: RCZ1" line43="    COUNTRY_SE = RCZ1 + 'S'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Sweden: RCZ1" line44="    COUNTRY_CH = RCZ1 + 'C'.charCodeAt(0) + ('H'.charCodeAt(0) &lt;&lt; 7),  //  Switzerland: RCZ1" line45="    COUNTRY_TW = RCZ4 + 'T'.charCodeAt(0) + ('W'.charCodeAt(0) &lt;&lt; 7),  //  Taiwan: RCZ4" line46="    COUNTRY_TH = RCZ4 + 'T'.charCodeAt(0) + ('H'.charCodeAt(0) &lt;&lt; 7),  //  Thailand: RCZ4" line47="    COUNTRY_TN = RCZ1 + 'T'.charCodeAt(0) + ('N'.charCodeAt(0) &lt;&lt; 7),  //  Tunisia: RCZ1" line48="    COUNTRY_GB = RCZ1 + 'G'.charCodeAt(0) + ('B'.charCodeAt(0) &lt;&lt; 7),  //  United Kingdom: RCZ1" line49="    COUNTRY_AE = RCZ1 + 'A'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  United Arab Emirates: RCZ1" line50="    COUNTRY_US = RCZ2 + 'U'.charCodeAt(0) + ('S'.charCodeAt(0) &lt;&lt; 7),  //  United States of America: RCZ2" line51="}" numlines="52"></mutation>↵                                                                                                                                                                                                                                                                        <field name="LINE0">enum Country {  //  Bits 0-6: First letter. Bits 7-13: Second letter.</field>↵                                                                                                                                                                                                                                                                        <field name="LINE1">    COUNTRY_AR = RCZ4 + 'A'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Argentina: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE2">    COUNTRY_AU = RCZ4 + 'A'.charCodeAt(0) + ('U'.charCodeAt(0) &lt;&lt; 7),  //  Australia: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE3">    COUNTRY_BE = RCZ1 + 'B'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Belgium: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE4">    COUNTRY_BR = RCZ2 + 'B'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Brazil: RCZ2</field>↵                                                                                                                                                                                                                                                                        <field name="LINE5">    COUNTRY_CL = RCZ4 + 'C'.charCodeAt(0) + ('L'.charCodeAt(0) &lt;&lt; 7),  //  Chile: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE6">    COUNTRY_CO = RCZ4 + 'C'.charCodeAt(0) + ('O'.charCodeAt(0) &lt;&lt; 7),  //  Colombia: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE7">    COUNTRY_CR = RCZ4 + 'C'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Costa Rica: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE8">    COUNTRY_HR = RCZ1 + 'H'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Croatia: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE9">    COUNTRY_CZ = RCZ1 + 'C'.charCodeAt(0) + ('Z'.charCodeAt(0) &lt;&lt; 7),  //  Czech Republic: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE10">    COUNTRY_DK = RCZ1 + 'D'.charCodeAt(0) + ('K'.charCodeAt(0) &lt;&lt; 7),  //  Denmark: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE11">    COUNTRY_EC = RCZ4 + 'E'.charCodeAt(0) + ('C'.charCodeAt(0) &lt;&lt; 7),  //  Ecuador: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE12">    COUNTRY_SV = RCZ4 + 'S'.charCodeAt(0) + ('V'.charCodeAt(0) &lt;&lt; 7),  //  El Salvador: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE13">    COUNTRY_EE = RCZ1 + 'E'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Estonia: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE14">    COUNTRY_FI = RCZ1 + 'F'.charCodeAt(0) + ('I'.charCodeAt(0) &lt;&lt; 7),  //  Finland: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE15">    COUNTRY_FR = RCZ1 + 'F'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  France: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE16">    COUNTRY_GF = RCZ1 + 'G'.charCodeAt(0) + ('F'.charCodeAt(0) &lt;&lt; 7),  //  French Guiana: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE17">    COUNTRY_PF = RCZ1 + 'P'.charCodeAt(0) + ('F'.charCodeAt(0) &lt;&lt; 7),  //  French Polynesia: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE18">    COUNTRY_DE = RCZ1 + 'D'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Germany: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE19">    COUNTRY_GP = RCZ1 + 'G'.charCodeAt(0) + ('P'.charCodeAt(0) &lt;&lt; 7),  //  Guadeloupe: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE20">    COUNTRY_HK = RCZ4 + 'H'.charCodeAt(0) + ('K'.charCodeAt(0) &lt;&lt; 7),  //  Hong Kong: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE21">    COUNTRY_HU = RCZ1 + 'H'.charCodeAt(0) + ('U'.charCodeAt(0) &lt;&lt; 7),  //  Hungary: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE22">    COUNTRY_IR = RCZ1 + 'I'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  Iran: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE23">    COUNTRY_IE = RCZ1 + 'I'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Ireland: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE24">    COUNTRY_IT = RCZ1 + 'I'.charCodeAt(0) + ('T'.charCodeAt(0) &lt;&lt; 7),  //  Italy: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE25">    COUNTRY_JP = RCZ3 + 'J'.charCodeAt(0) + ('P'.charCodeAt(0) &lt;&lt; 7),  //  Japan: RCZ3</field>↵                                                                                                                                                                                                                                                                        <field name="LINE26">    COUNTRY_LU = RCZ1 + 'L'.charCodeAt(0) + ('U'.charCodeAt(0) &lt;&lt; 7),  //  Luxembourg: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE27">    COUNTRY_MY = RCZ4 + 'M'.charCodeAt(0) + ('Y'.charCodeAt(0) &lt;&lt; 7),  //  Malaysia: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE28">    COUNTRY_MT = RCZ1 + 'M'.charCodeAt(0) + ('T'.charCodeAt(0) &lt;&lt; 7),  //  Malta: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE29">    COUNTRY_MQ = RCZ1 + 'M'.charCodeAt(0) + ('Q'.charCodeAt(0) &lt;&lt; 7),  //  Martinique: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE30">    COUNTRY_MX = RCZ2 + 'M'.charCodeAt(0) + ('X'.charCodeAt(0) &lt;&lt; 7),  //  Mexico: RCZ2</field>↵                                                                                                                                                                                                                                                                        <field name="LINE31">    COUNTRY_NL = RCZ1 + 'N'.charCodeAt(0) + ('L'.charCodeAt(0) &lt;&lt; 7),  //  Netherlands: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE32">    COUNTRY_NC = RCZ1 + 'N'.charCodeAt(0) + ('C'.charCodeAt(0) &lt;&lt; 7),  //  New Caledonia: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE33">    COUNTRY_NZ = RCZ4 + 'N'.charCodeAt(0) + ('Z'.charCodeAt(0) &lt;&lt; 7),  //  New Zealand: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE34">    COUNTRY_OM = RCZ1 + 'O'.charCodeAt(0) + ('M'.charCodeAt(0) &lt;&lt; 7),  //  Oman: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE35">    COUNTRY_PA = RCZ4 + 'P'.charCodeAt(0) + ('A'.charCodeAt(0) &lt;&lt; 7),  //  Panama: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE36">    COUNTRY_PT = RCZ1 + 'P'.charCodeAt(0) + ('T'.charCodeAt(0) &lt;&lt; 7),  //  Portugal: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE37">    COUNTRY_RE = RCZ1 + 'R'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Réunion: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE38">    COUNTRY_SG = RCZ4 + 'S'.charCodeAt(0) + ('G'.charCodeAt(0) &lt;&lt; 7),  //  Singapore: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE39">    COUNTRY_SK = RCZ1 + 'S'.charCodeAt(0) + ('K'.charCodeAt(0) &lt;&lt; 7),  //  Slovakia: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE40">    COUNTRY_ZA = RCZ1 + 'Z'.charCodeAt(0) + ('A'.charCodeAt(0) &lt;&lt; 7),  //  South Africa: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE41">    COUNTRY_KR = RCZ3 + 'K'.charCodeAt(0) + ('R'.charCodeAt(0) &lt;&lt; 7),  //  South Korea: RCZ3</field>↵                                                                                                                                                                                                                                                                        <field name="LINE42">    COUNTRY_ES = RCZ1 + 'E'.charCodeAt(0) + ('S'.charCodeAt(0) &lt;&lt; 7),  //  Spain: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE43">    COUNTRY_SE = RCZ1 + 'S'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  Sweden: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE44">    COUNTRY_CH = RCZ1 + 'C'.charCodeAt(0) + ('H'.charCodeAt(0) &lt;&lt; 7),  //  Switzerland: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE45">    COUNTRY_TW = RCZ4 + 'T'.charCodeAt(0) + ('W'.charCodeAt(0) &lt;&lt; 7),  //  Taiwan: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE46">    COUNTRY_TH = RCZ4 + 'T'.charCodeAt(0) + ('H'.charCodeAt(0) &lt;&lt; 7),  //  Thailand: RCZ4</field>↵                                                                                                                                                                                                                                                                        <field name="LINE47">    COUNTRY_TN = RCZ1 + 'T'.charCodeAt(0) + ('N'.charCodeAt(0) &lt;&lt; 7),  //  Tunisia: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE48">    COUNTRY_GB = RCZ1 + 'G'.charCodeAt(0) + ('B'.charCodeAt(0) &lt;&lt; 7),  //  United Kingdom: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE49">    COUNTRY_AE = RCZ1 + 'A'.charCodeAt(0) + ('E'.charCodeAt(0) &lt;&lt; 7),  //  United Arab Emirates: RCZ1</field>↵                                                                                                                                                                                                                                                                        <field name="LINE50">    COUNTRY_US = RCZ2 + 'U'.charCodeAt(0) + ('S'.charCodeAt(0) &lt;&lt; 7),  //  United States of America: RCZ2</field>↵                                                                                                                                                                                                                                                                        <field name="LINE51">}</field>↵                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                            <mutation line0="const END_OF_RESPONSE = '\r'.charCodeAt(0)" numlines="1" declaredvars="END_OF_RESPONSE"></mutation>↵                                                                                                                                                                                                                                                                            <field name="LINE0">const END_OF_RESPONSE = '\r'.charCodeAt(0)</field>↵                                                                                                                                                                                                                                                                            <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////// From wisol.cpp</comment>↵                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                <mutation line0="const CMD_END = &quot;\r&quot;" numlines="1" declaredvars="CMD_END"></mutation>↵                                                                                                                                                                                                                                                                                <field name="LINE0">const CMD_END = "\r"</field>↵                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                    <mutation line0="const endOfList: NetworkCmd = {" line1="    sendData: null," line2="    expectedMarkerCount: 0," line3="    processFunc: null," line4="    payload: null," line5="    sendData2: null" line6="};" numlines="7" declaredvars="endOfList"></mutation>↵                                                                                                                                                                                                                                                                                    <field name="LINE0">const endOfList: NetworkCmd = {</field>↵                                                                                                                                                                                                                                                                                    <field name="LINE1">    sendData: null,</field>↵                                                                                                                                                                                                                                                                                    <field name="LINE2">    expectedMarkerCount: 0,</field>↵                                                                                                                                                                                                                                                                                    <field name="LINE3">    processFunc: null,</field>↵                                                                                                                                                                                                                                                                                    <field name="LINE4">    payload: null,</field>↵                                                                                                                                                                                                                                                                                    <field name="LINE5">    sendData2: null</field>↵                                                                                                                                                                                                                                                                                    <field name="LINE6">};</field>↵                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                        <mutation line0="let sendSemaphore: Sem_t = {};" numlines="1" declaredvars="sendSemaphore"></mutation>↵                                                                                                                                                                                                                                                                                        <field name="LINE0">let sendSemaphore: Sem_t = {};</field>↵                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                            <mutation line0="function network_task(msg: SensorMsg): void {" line1="    //  Loop forever, receiving sensor data messages and sending to UART Task to transmit to the network." line2="    //  Note: Declare task variables here before task_open() but don't populate them here" line3="    //  unless they are not supposed to change. Because the coroutine will execute this code " line4="    //  repeatedly and repopulate the values." line5="    let cmd: NetworkCmd;" line6="    let shouldSend: boolean;" line7="" line8="    task_open();  //  Start of the task. Must be matched with task_close().  " line9="    if (!successEvent) { successEvent = event_create(); }  //  Create event for UART Task to indicate success." line10="    if (!failureEvent) { failureEvent = event_create(); }  //  Another event to indicate failure." line11="" line12="    for (let j = 0; j &lt; 1; j++) {  //  Run the sensor data receiving code once only." line13="        //  If this is a UART response message, process the pending response." line14="        if (msg.name === RESPONSE_SENSOR_NAME) {" line15="            processPendingResponse(ctx());" line16="            continue;" line17="        }" line18="        //  Aggregate the sensor data.  Determine whether we should send to network now." line19="        cmdList[0] = endOfList;  //  Empty the command list." line20="        shouldSend = aggregate_sensor_data(ctx(), msg, cmdList, MAX_NETWORK_CMD_LIST_SIZE);  //  Fetch the command list into cmdList." line21="        if (!shouldSend) { continue; }  //  If we should not send now: Loop and wait for next message." line22="" line23="        //  Use a semaphore to limit sending to only 1 message at a time, because our buffers are shared." line24="        debug(F(&quot;net &gt;&gt; Wait for net&quot;));" line25="        sem_wait(sendSemaphore);  //  Wait until no other message is being sent. Then lock the semaphore." line26="        debug(F(&quot;net &gt;&gt; Got net&quot;));" line27="" line28="        cmdList.forEach(function (value: NetworkCmd, index: number) {" line29="            debug(&quot;cmdList[]=&quot;, value.sendData);////            " line30="        })" line31="" line32="        //  Init the context." line33="        ctx().status = true;            //  Assume no error." line34="        ctx().pendingResponse = false;  //  Assume no need to wait for response." line35="        ctx().msg = msg;               //  Remember the message until it's sent via UART.  " line36="        ctx().downlinkData = null;      //  No downlink received yet.  " line37="        ctx().cmdList = cmdList;        //  Run the command list." line38="        ctx().cmdIndex = 0;             //  Start at first command in command list." line39="        ctx().lastSend = millis() + MAX_TIMEOUT;  //  Set to a high timeout to prevent other requests from attempting to send." line40="" line41="        ///////////////////////////////////////////////////////////////////////////" line42="        //  Wisol AT Command List Processing Loop" line43="        for (; ;) {  //  Send each Wisol AT command in the list." line44="            ctx().lastSend = millis();  //  Update the last send time." line45="" line46="            if (ctx().cmdIndex &gt;= MAX_NETWORK_CMD_LIST_SIZE) { break; }  //  Check that we don't exceed the array bounds." line47="            cmd = ctx().cmdList[ctx().cmdIndex];  //  Fetch the current command.        " line48="            if (!cmd.sendData) { break; }     //  If no more commands to send, stop." line49="" line50="            //  Convert Wisol command to UART command." line51="            debug(&quot;cmd1 &quot;, cmd.sendData);////            " line52="            convertCmdToUART(cmd, ctx(), uartMsg, successEvent, failureEvent, responseMsg, os_get_running_tid());" line53="            debug(&quot;cmd2 &quot;, cmd.sendData);////            " line54="            ctx().lastSend = millis() + uartMsg.timeout;  //  Estimate last send time for the next command." line55="            ctx().pendingProcessFunc = cmd.processFunc;   //  Call this function to process response later." line56="" line57="            //  Transmit the UART command to the UART port by sending to the UART Task." line58="            //  msg_post() is a synchronised send - it waits for the queue to be available before sending." line59="            msg_post(ctx().uartTaskID, uartMsg);  //  Send the message to the UART task for transmission." line60="" line61="            //  When sending the last step of Sigfox message payload: Break out of the loop and release the semaphore lock. " line62="            if (uartMsg.responseMsg) { //  This is the last command in the list and it will take some time.  Instead of waiting for" line63="                ctx().pendingResponse = true;   //  UART Task to signal us via an Event, we let UART Task signal us via a Message instead." line64="                break;                          //  By releasing the semaphore we allow other tasks to run and improve the multitasking." line65="            }" line66="            //  Wait for success or failure event then process the response." line67="            event_wait_multiple(0, successEvent, failureEvent);  //  0 means wait for any event." line68="            processResponse(ctx());  //  Process the response by calling the response function." line69="            if (!ctx().status) { break; }  //  Quit if the processing failed." line70="" line71="            //  Command was transmitted successfully. Move to next command." line72="            ctx().cmdIndex++;  //  Next Wisol command." line73="        }  //  Loop to next Wisol command." line74="        //  All Wisol AT commands sent for the step." line75="" line76="        ///////////////////////////////////////////////////////////////////////////" line77="        //  Wisol AT Command List Completed Processing" line78="        //  Clean up the context and release the semaphore." line79="        msg.name = null;       //  Erase the &quot;begin&quot; sensor name." line80="        ctx().msg = null;      //  Erase the message." line81="        ctx().cmdList = null;  //  Erase the command list." line82="" line83="        //  Release the semaphore and allow another payload to be sent after SEND_INTERVAL." line84="        debug(F(&quot;net &gt;&gt; Release net&quot;));" line85="        sem_signal(sendSemaphore);" line86="    }  //  Loop to next incoming sensor data message." line87="    task_close();  //  End of the task. Should not come here." line88="}" numlines="89"></mutation>↵                                                                                                                                                                                                                                                                                            <field name="LINE0">function network_task(msg: SensorMsg): void {</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE1">    //  Loop forever, receiving sensor data messages and sending to UART Task to transmit to the network.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE2">    //  Note: Declare task variables here before task_open() but don't populate them here</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE3">    //  unless they are not supposed to change. Because the coroutine will execute this code </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE4">    //  repeatedly and repopulate the values.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE5">    let cmd: NetworkCmd;</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE6">    let shouldSend: boolean;</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE7"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE8">    task_open();  //  Start of the task. Must be matched with task_close().  </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE9">    if (!successEvent) { successEvent = event_create(); }  //  Create event for UART Task to indicate success.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE10">    if (!failureEvent) { failureEvent = event_create(); }  //  Another event to indicate failure.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE11"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE12">    for (let j = 0; j &lt; 1; j++) {  //  Run the sensor data receiving code once only.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE13">        //  If this is a UART response message, process the pending response.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE14">        if (msg.name === RESPONSE_SENSOR_NAME) {</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE15">            processPendingResponse(ctx());</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE16">            continue;</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE17">        }</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE18">        //  Aggregate the sensor data.  Determine whether we should send to network now.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE19">        cmdList[0] = endOfList;  //  Empty the command list.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE20">        shouldSend = aggregate_sensor_data(ctx(), msg, cmdList, MAX_NETWORK_CMD_LIST_SIZE);  //  Fetch the command list into cmdList.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE21">        if (!shouldSend) { continue; }  //  If we should not send now: Loop and wait for next message.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE22"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE23">        //  Use a semaphore to limit sending to only 1 message at a time, because our buffers are shared.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE24">        debug(F("net &gt;&gt; Wait for net"));</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE25">        sem_wait(sendSemaphore);  //  Wait until no other message is being sent. Then lock the semaphore.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE26">        debug(F("net &gt;&gt; Got net"));</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE27"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE28">        cmdList.forEach(function (value: NetworkCmd, index: number) {</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE29">            debug("cmdList[]=", value.sendData);////            </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE30">        })</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE31"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE32">        //  Init the context.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE33">        ctx().status = true;            //  Assume no error.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE34">        ctx().pendingResponse = false;  //  Assume no need to wait for response.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE35">        ctx().msg = msg;               //  Remember the message until it's sent via UART.  </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE36">        ctx().downlinkData = null;      //  No downlink received yet.  </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE37">        ctx().cmdList = cmdList;        //  Run the command list.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE38">        ctx().cmdIndex = 0;             //  Start at first command in command list.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE39">        ctx().lastSend = millis() + MAX_TIMEOUT;  //  Set to a high timeout to prevent other requests from attempting to send.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE40"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE41">        ///////////////////////////////////////////////////////////////////////////</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE42">        //  Wisol AT Command List Processing Loop</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE43">        for (; ;) {  //  Send each Wisol AT command in the list.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE44">            ctx().lastSend = millis();  //  Update the last send time.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE45"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE46">            if (ctx().cmdIndex &gt;= MAX_NETWORK_CMD_LIST_SIZE) { break; }  //  Check that we don't exceed the array bounds.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE47">            cmd = ctx().cmdList[ctx().cmdIndex];  //  Fetch the current command.        </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE48">            if (!cmd.sendData) { break; }     //  If no more commands to send, stop.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE49"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE50">            //  Convert Wisol command to UART command.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE51">            debug("cmd1 ", cmd.sendData);////            </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE52">            convertCmdToUART(cmd, ctx(), uartMsg, successEvent, failureEvent, responseMsg, os_get_running_tid());</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE53">            debug("cmd2 ", cmd.sendData);////            </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE54">            ctx().lastSend = millis() + uartMsg.timeout;  //  Estimate last send time for the next command.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE55">            ctx().pendingProcessFunc = cmd.processFunc;   //  Call this function to process response later.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE56"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE57">            //  Transmit the UART command to the UART port by sending to the UART Task.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE58">            //  msg_post() is a synchronised send - it waits for the queue to be available before sending.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE59">            msg_post(ctx().uartTaskID, uartMsg);  //  Send the message to the UART task for transmission.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE60"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE61">            //  When sending the last step of Sigfox message payload: Break out of the loop and release the semaphore lock. </field>↵                                                                                                                                                                                                                                                                                            <field name="LINE62">            if (uartMsg.responseMsg) { //  This is the last command in the list and it will take some time.  Instead of waiting for</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE63">                ctx().pendingResponse = true;   //  UART Task to signal us via an Event, we let UART Task signal us via a Message instead.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE64">                break;                          //  By releasing the semaphore we allow other tasks to run and improve the multitasking.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE65">            }</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE66">            //  Wait for success or failure event then process the response.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE67">            event_wait_multiple(0, successEvent, failureEvent);  //  0 means wait for any event.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE68">            processResponse(ctx());  //  Process the response by calling the response function.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE69">            if (!ctx().status) { break; }  //  Quit if the processing failed.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE70"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE71">            //  Command was transmitted successfully. Move to next command.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE72">            ctx().cmdIndex++;  //  Next Wisol command.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE73">        }  //  Loop to next Wisol command.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE74">        //  All Wisol AT commands sent for the step.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE75"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE76">        ///////////////////////////////////////////////////////////////////////////</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE77">        //  Wisol AT Command List Completed Processing</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE78">        //  Clean up the context and release the semaphore.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE79">        msg.name = null;       //  Erase the "begin" sensor name.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE80">        ctx().msg = null;      //  Erase the message.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE81">        ctx().cmdList = null;  //  Erase the command list.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE82"></field>↵                                                                                                                                                                                                                                                                                            <field name="LINE83">        //  Release the semaphore and allow another payload to be sent after SEND_INTERVAL.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE84">        debug(F("net &gt;&gt; Release net"));</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE85">        sem_signal(sendSemaphore);</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE86">    }  //  Loop to next incoming sensor data message.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE87">    task_close();  //  End of the task. Should not come here.</field>↵                                                                                                                                                                                                                                                                                            <field name="LINE88">}</field>↵                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                <mutation line0="function processPendingResponse(context: NetworkContext): void {" line1="    //  If there is a pending response, e.g. from send payload..." line2="    debug(F(&quot;net &gt;&gt; Pending response&quot;));" line3="    if (!context.pendingResponse) {" line4="        debug(F(&quot;***** Error: No pending response&quot;));" line5="        return;" line6="    }" line7="    context.pendingResponse = false;" line8="    processResponse(context);     //  Process the response by calling the response function." line9="    context.lastSend = millis();  //  Update the last send time." line10="    //  Process the downlink message, if any. This is located outside the semaphore lock for performance." line11="    if (context.downlinkData) {" line12="        process_downlink_msg(context, context.status, context.downlinkData);" line13="    }" line14="}" numlines="15"></mutation>↵                                                                                                                                                                                                                                                                                                <field name="LINE0">function processPendingResponse(context: NetworkContext): void {</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE1">    //  If there is a pending response, e.g. from send payload...</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE2">    debug(F("net &gt;&gt; Pending response"));</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE3">    if (!context.pendingResponse) {</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE4">        debug(F("***** Error: No pending response"));</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE5">        return;</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE6">    }</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE7">    context.pendingResponse = false;</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE8">    processResponse(context);     //  Process the response by calling the response function.</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE9">    context.lastSend = millis();  //  Update the last send time.</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE10">    //  Process the downlink message, if any. This is located outside the semaphore lock for performance.</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE11">    if (context.downlinkData) {</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE12">        process_downlink_msg(context, context.status, context.downlinkData);</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE13">    }</field>↵                                                                                                                                                                                                                                                                                                <field name="LINE14">}</field>↵                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                    <mutation line0="function processResponse(context: NetworkContext): void {" line1="    //  Process the response from the Wisol AT Command by calling the" line2="    //  process response function.  Set the status to false if the processing failed." line3="" line4="    //  Get the response text." line5="    const response: string = (context &amp;&amp; context.uartContext)" line6="        ? context.uartContext.response" line7="        : &quot;&quot;;" line8="    //  Process the response text, regardless of success/failure." line9="    //  Call the process response function if has been set." line10="    if (context.pendingProcessFunc) {" line11="        const processStatus = (context.pendingProcessFunc)(context, response);" line12="        //  If response processing failed, stop." line13="        if (!processStatus) {" line14="            context.status = false;  //  Propagate status to Wisol context." line15="            debug(F(&quot;***** Error: network_task Result processing failed, response: &quot;), response);" line16="            return;  //  Quit processing." line17="        }" line18="    }" line19="    //  In case of failure, stop." line20="    if (!context.uartContext.status) {" line21="        context.status = false;  //  Propagate status to Wisol context." line22="        debug(F(&quot;***** Error: network_task Failed, response: &quot;), response);" line23="        return;  //  Quit processing." line24="    }" line25="}" numlines="26"></mutation>↵                                                                                                                                                                                                                                                                                                    <field name="LINE0">function processResponse(context: NetworkContext): void {</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE1">    //  Process the response from the Wisol AT Command by calling the</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE2">    //  process response function.  Set the status to false if the processing failed.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE3"></field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE4">    //  Get the response text.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE5">    const response: string = (context &amp;&amp; context.uartContext)</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE6">        ? context.uartContext.response</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE7">        : "";</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE8">    //  Process the response text, regardless of success/failure.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE9">    //  Call the process response function if has been set.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE10">    if (context.pendingProcessFunc) {</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE11">        const processStatus = (context.pendingProcessFunc)(context, response);</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE12">        //  If response processing failed, stop.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE13">        if (!processStatus) {</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE14">            context.status = false;  //  Propagate status to Wisol context.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE15">            debug(F("***** Error: network_task Result processing failed, response: "), response);</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE16">            return;  //  Quit processing.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE17">        }</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE18">    }</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE19">    //  In case of failure, stop.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE20">    if (!context.uartContext.status) {</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE21">        context.status = false;  //  Propagate status to Wisol context.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE22">        debug(F("***** Error: network_task Failed, response: "), response);</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE23">        return;  //  Quit processing.</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE24">    }</field>↵                                                                                                                                                                                                                                                                                                    <field name="LINE25">}</field>↵                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                                                                                                                                        <field name="VAR" id="%/eQmpx(?(3v1l@Q%y7~" variabletype="">CMD_NONE</field>↵                                                                                                                                                                                                                                                                                                        <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////////// Define the Wisol AT Commands based on WISOLUserManual_EVBSFM10RxAT_Rev.9_180115.pdf</comment>↵                                                                                                                                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                                                                                          <block type="text">↵                                                                                                                                                                                                                                                                                                            <field name="TEXT">AT</field>↵                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                                                                                                                                                                            <field name="VAR" id="U~oM!WN3r@y=Su6R8e;W" variabletype="">CMD_OUTPUT_POWER_MAX</field>↵                                                                                                                                                                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                                                                                              <block type="text">↵                                                                                                                                                                                                                                                                                                                <field name="TEXT">ATS302=15</field>↵                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                              <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                <field name="VAR" id="cn.3w0O!NC!d$*aK%~re" variabletype="">CMD_GET_CHANNEL</field>↵                                                                                                                                                                                                                                                                                                                <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                    <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                                                                                  <block type="text">↵                                                                                                                                                                                                                                                                                                                    <field name="TEXT">AT$GI?</field>↵                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                  <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                    <field name="VAR" id="va_BfuYFtB`i0y-8-E~O" variabletype="">CMD_RESET_CHANNEL</field>↵                                                                                                                                                                                                                                                                                                                    <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                        <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                                                                                                      <block type="text">↵                                                                                                                                                                                                                                                                                                                        <field name="TEXT">AT$RC</field>↵                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                        <field name="VAR" id="*{Mc?;um0J[5#sBJT~:?" variabletype="">CMD_SEND_MESSAGE</field>↵                                                                                                                                                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                                                                                                          <block type="text">↵                                                                                                                                                                                                                                                                                                                            <field name="TEXT">AT$SF=</field>↵                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                            <field name="VAR" id="rIFpL!tP?N,tIsLWsVAW" variabletype="">CMD_SEND_MESSAGE_RESPONSE</field>↵                                                                                                                                                                                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                                                                                                              <block type="text">↵                                                                                                                                                                                                                                                                                                                                <field name="TEXT">,1</field>↵                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                              <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                                <field name="VAR" id="oweKg~rL6!J{A%=eN6.f" variabletype="">CMD_GET_ID</field>↵                                                                                                                                                                                                                                                                                                                                <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                    <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                                                                                                  <block type="text">↵                                                                                                                                                                                                                                                                                                                                    <field name="TEXT">AT$I=10</field>↵                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                  <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                                    <field name="VAR" id="5~3?P)To#}_B}[*oDTzi" variabletype="">CMD_GET_PAC</field>↵                                                                                                                                                                                                                                                                                                                                    <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                        <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                                                                                                                      <block type="text">↵                                                                                                                                                                                                                                                                                                                                        <field name="TEXT">AT$I=11</field>↵                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                                        <field name="VAR" id="v[*/17pm7Vc6N*%bT]y7" variabletype="">CMD_EMULATOR_DISABLE</field>↵                                                                                                                                                                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                                                                                                                          <block type="text">↵                                                                                                                                                                                                                                                                                                                                            <field name="TEXT">ATS410=0</field>↵                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                          <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                                            <field name="VAR" id="iBC(,|=73Hf|,!MG`/l?" variabletype="">CMD_EMULATOR_ENABLE</field>↵                                                                                                                                                                                                                                                                                                                                            <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                                                                                                                              <block type="text">↵                                                                                                                                                                                                                                                                                                                                                <field name="TEXT">ATS410=1</field>↵                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                <mutation line0="function getStepBegin(" line1="    context: NetworkContext," line2="    args: StepArgs): void {" line3="    //  Return the list of Wisol AT commands for the Begin Step, to start up the Wisol module.  //  debug(F(&quot; - wisol.getStepBegin&quot;));" line4="    addCmd(args.list, args.listSize, {" line5="        //  Set emulation mode." line6="        sendData: context.useEmulator  //  If emulator mode," line7="            ? F(CMD_EMULATOR_ENABLE)   //  Device will only talk to SNEK emulator." line8="            : F(CMD_EMULATOR_DISABLE), //  Else device will only talk to Sigfox network." line9="        expectedMarkerCount: 1," line10="        processFunc: null," line11="        payload: null, sendData2: null" line12="    });" line13="    //  Get Sigfox device ID and PAC." line14="    addCmd(args.list, args.listSize, {" line15="        sendData: F(CMD_GET_ID)," line16="        expectedMarkerCount: 1," line17="        processFunc: getID," line18="        payload: null, sendData2: null" line19="    });" line20="    addCmd(args.list, args.listSize, {" line21="        sendData: F(CMD_GET_PAC)," line22="        expectedMarkerCount: 1," line23="        processFunc: getPAC," line24="        payload: null, sendData2: null" line25="    });" line26="}" numlines="27"></mutation>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function getStepBegin(</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    context: NetworkContext,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    args: StepArgs): void {</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">    //  Return the list of Wisol AT commands for the Begin Step, to start up the Wisol module.  //  debug(F(" - wisol.getStepBegin"));</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE4">    addCmd(args.list, args.listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE5">        //  Set emulation mode.</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE6">        sendData: context.useEmulator  //  If emulator mode,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE7">            ? F(CMD_EMULATOR_ENABLE)   //  Device will only talk to SNEK emulator.</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE8">            : F(CMD_EMULATOR_DISABLE), //  Else device will only talk to Sigfox network.</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE9">        expectedMarkerCount: 1,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE10">        processFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE11">        payload: null, sendData2: null</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE12">    });</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE13">    //  Get Sigfox device ID and PAC.</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE14">    addCmd(args.list, args.listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE15">        sendData: F(CMD_GET_ID),</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE16">        expectedMarkerCount: 1,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE17">        processFunc: getID,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE18">        payload: null, sendData2: null</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE19">    });</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE20">    addCmd(args.list, args.listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE21">        sendData: F(CMD_GET_PAC),</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE22">        expectedMarkerCount: 1,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE23">        processFunc: getPAC,</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE24">        payload: null, sendData2: null</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE25">    });</field>↵                                                                                                                                                                                                                                                                                                                                                <field name="LINE26">}</field>↵                                                                                                                                                                                                                                                                                                                                                <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////////// Wisol Command Steps: A Command Step contains a list of Wisol AT Commands to be sent for executing the step.  We only implement 2 steps for the Wisol module: Begin Step -&gt; Send Step (1) Begin Step: On startup, set the emulation mode and get the device ID and PAC. (2) Send Step: Send the payload, after setting the TX power and channel. Optional: Request for downlink Each Wisol AT Command added through addCmd() may include a Response Processing Function e.g. getID(), getPAC().  The function is called with the response text generated from the Wisol AT Command.</comment>↵                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function getStepSend(" line1="    context: NetworkContext," line2="    args: StepArgs): void {" line3="    //  Return the list of Wisol AT commands for the Send Step, to send the payload." line4="    //  Payload contains a string of hex digits, up to 24 digits / 12 bytes." line5="    //  We prefix with AT$SF= and send to the transceiver.  If enableDownlink is true, we append the" line6="    //  CMD_SEND_MESSAGE_RESPONSE command to indicate that we expect a downlink repsonse." line7="    //  The downlink response message from Sigfox will be returned in the response parameter." line8="    //  Warning: This may take up to 1 min to run.  //  debug(F(&quot; - wisol.getStepSend&quot;));" line9="    //  Set the output power for the zone." line10="    getStepPowerChannel(context, args.list, args.listSize);" line11="" line12="    //  Compose the payload sending command." line13="    let markers = 1;  //  Wait for 1 line of response." line14="    let processFunc: (context: NetworkContext, response: string) =&gt; boolean = null;  //  Function to process result." line15="    let sendData2: string = null;  //  Text to be appended to payload." line16="" line17="    // If no downlink: Send CMD_SEND_MESSAGE + payload" line18="    if (args.enableDownlink) {" line19="        //  For downlink mode: send CMD_SEND_MESSAGE + payload + CMD_SEND_MESSAGE_RESPONSE" line20="        markers++;  //  Wait for one more response line.   " line21="        processFunc = getDownlink;  //  Process the downlink message." line22="        sendData2 = F(CMD_SEND_MESSAGE_RESPONSE);  //  Append suffix to payload." line23="    }" line24="    addCmd(args.list, args.listSize, {" line25="        sendData: F(CMD_SEND_MESSAGE)," line26="        expectedMarkerCount: markers," line27="        processFunc: processFunc," line28="        payload: args.payload," line29="        sendData2: sendData2" line30="    });" line31="}" numlines="32"></mutation>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function getStepSend(</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    context: NetworkContext,</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    args: StepArgs): void {</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3">    //  Return the list of Wisol AT commands for the Send Step, to send the payload.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE4">    //  Payload contains a string of hex digits, up to 24 digits / 12 bytes.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE5">    //  We prefix with AT$SF= and send to the transceiver.  If enableDownlink is true, we append the</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE6">    //  CMD_SEND_MESSAGE_RESPONSE command to indicate that we expect a downlink repsonse.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE7">    //  The downlink response message from Sigfox will be returned in the response parameter.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE8">    //  Warning: This may take up to 1 min to run.  //  debug(F(" - wisol.getStepSend"));</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE9">    //  Set the output power for the zone.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE10">    getStepPowerChannel(context, args.list, args.listSize);</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE11"></field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE12">    //  Compose the payload sending command.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE13">    let markers = 1;  //  Wait for 1 line of response.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE14">    let processFunc: (context: NetworkContext, response: string) =&gt; boolean = null;  //  Function to process result.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE15">    let sendData2: string = null;  //  Text to be appended to payload.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE16"></field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE17">    // If no downlink: Send CMD_SEND_MESSAGE + payload</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE18">    if (args.enableDownlink) {</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE19">        //  For downlink mode: send CMD_SEND_MESSAGE + payload + CMD_SEND_MESSAGE_RESPONSE</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE20">        markers++;  //  Wait for one more response line.   </field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE21">        processFunc = getDownlink;  //  Process the downlink message.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE22">        sendData2 = F(CMD_SEND_MESSAGE_RESPONSE);  //  Append suffix to payload.</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE23">    }</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE24">    addCmd(args.list, args.listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE25">        sendData: F(CMD_SEND_MESSAGE),</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE26">        expectedMarkerCount: markers,</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE27">        processFunc: processFunc,</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE28">        payload: args.payload,</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE29">        sendData2: sendData2</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE30">    });</field>↵                                                                                                                                                                                                                                                                                                                                                    <field name="LINE31">}</field>↵                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function getStepPowerChannel(context: NetworkContext, list: Array&lt;NetworkCmd&gt;, listSize: number): void {" line1="    //  Return the Wisol AT commands to set the transceiver output power and channel for the zone." line2="    //  See WISOLUserManual_EVBSFM10RxAT_Rev.9_180115.pdf, http://kochingchang.blogspot.com/2018/06/minisigfox.html  //  debug(F(&quot; - wisol.getStepPowerChannel&quot;));" line3="    switch (context.zone) {" line4="        case RCZ1:" line5="        case RCZ3:" line6="            //  Set the transceiver output power." line7="            addCmd(list, listSize, {" line8="                sendData: F(CMD_OUTPUT_POWER_MAX)," line9="                expectedMarkerCount: 1," line10="                processFunc: null," line11="                payload: null, sendData2: null" line12="            });" line13="            break;" line14="        case RCZ2:" line15="        case RCZ4: {" line16="            //  Get the current and next macro channel usage. Returns X,Y:" line17="            //  X: boolean value, indicating previous TX macro channel was in the Sigfox default channel" line18="            //  Y: number of micro channel available for next TX request in current macro channel." line19="            //  Call checkChannel() to check the response." line20="            addCmd(list, listSize, {" line21="                sendData: F(CMD_GET_CHANNEL)," line22="                expectedMarkerCount: 1," line23="                processFunc: checkChannel," line24="                payload: null, sendData2: null" line25="            });" line26="" line27="            //  If X=0 or Y&lt;3, send CMD_RESET_CHANNEL to reset the device on the default Sigfox macro channel." line28="            //  Note: Don't use with a duty cycle less than 20 seconds." line29="            //  Note: checkChannel() will change this command to CMD_NONE if not required." line30="            addCmd(list, listSize, {" line31="                sendData: F(CMD_RESET_CHANNEL)," line32="                expectedMarkerCount: 1," line33="                processFunc: null," line34="                payload: null, sendData2: null" line35="            });" line36="            break;" line37="        }" line38="    }" line39="}" numlines="40"></mutation>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function getStepPowerChannel(context: NetworkContext, list: Array&lt;NetworkCmd&gt;, listSize: number): void {</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE1">    //  Return the Wisol AT commands to set the transceiver output power and channel for the zone.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE2">    //  See WISOLUserManual_EVBSFM10RxAT_Rev.9_180115.pdf, http://kochingchang.blogspot.com/2018/06/minisigfox.html  //  debug(F(" - wisol.getStepPowerChannel"));</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE3">    switch (context.zone) {</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE4">        case RCZ1:</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE5">        case RCZ3:</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE6">            //  Set the transceiver output power.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE7">            addCmd(list, listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE8">                sendData: F(CMD_OUTPUT_POWER_MAX),</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE9">                expectedMarkerCount: 1,</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE10">                processFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE11">                payload: null, sendData2: null</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE12">            });</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE13">            break;</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE14">        case RCZ2:</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE15">        case RCZ4: {</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE16">            //  Get the current and next macro channel usage. Returns X,Y:</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE17">            //  X: boolean value, indicating previous TX macro channel was in the Sigfox default channel</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE18">            //  Y: number of micro channel available for next TX request in current macro channel.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE19">            //  Call checkChannel() to check the response.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE20">            addCmd(list, listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE21">                sendData: F(CMD_GET_CHANNEL),</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE22">                expectedMarkerCount: 1,</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE23">                processFunc: checkChannel,</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE24">                payload: null, sendData2: null</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE25">            });</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE26"></field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE27">            //  If X=0 or Y&lt;3, send CMD_RESET_CHANNEL to reset the device on the default Sigfox macro channel.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE28">            //  Note: Don't use with a duty cycle less than 20 seconds.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE29">            //  Note: checkChannel() will change this command to CMD_NONE if not required.</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE30">            addCmd(list, listSize, {</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE31">                sendData: F(CMD_RESET_CHANNEL),</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE32">                expectedMarkerCount: 1,</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE33">                processFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE34">                payload: null, sendData2: null</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE35">            });</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE36">            break;</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE37">        }</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE38">    }</field>↵                                                                                                                                                                                                                                                                                                                                                        <field name="LINE39">}</field>↵                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function getID(context: NetworkContext, response: string): boolean {" line1="    //  Save the device ID to context." line2="    context.device = response;" line3="    debug(F(&quot; - wisol.getID: &quot;), context.device);" line4="    return true;" line5="}" numlines="6"></mutation>↵                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function getID(context: NetworkContext, response: string): boolean {</field>↵                                                                                                                                                                                                                                                                                                                                                            <field name="LINE1">    //  Save the device ID to context.</field>↵                                                                                                                                                                                                                                                                                                                                                            <field name="LINE2">    context.device = response;</field>↵                                                                                                                                                                                                                                                                                                                                                            <field name="LINE3">    debug(F(" - wisol.getID: "), context.device);</field>↵                                                                                                                                                                                                                                                                                                                                                            <field name="LINE4">    return true;</field>↵                                                                                                                                                                                                                                                                                                                                                            <field name="LINE5">}</field>↵                                                                                                                                                                                                                                                                                                                                                            <comment pinned="false" h="120" w="160">///////////////////////////////////////////////////////////////////////////// Wisol Response Processing Functions: Called to process response when response is received from Wisol AT Command.</comment>↵                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function getPAC(context: NetworkContext, response: string): boolean {" line1="    //  Save the PAC code to context.  Note that the PAC is only valid" line2="    //  for the first registration in the Sigfox portal.  After" line3="    //  registering the device, the PAC is changed in the Sigfox portal" line4="    //  but not in the Wisol AT Command.  You must get the updated" line5="    //  PAC from the Sigfox portal if you wish to transfer the device." line6="    context.pac = response;" line7="    debug(F(&quot; - wisol.getPAC: &quot;), context.pac);" line8="    return true;" line9="}" numlines="10"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function getPAC(context: NetworkContext, response: string): boolean {</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    //  Save the PAC code to context.  Note that the PAC is only valid</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    //  for the first registration in the Sigfox portal.  After</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">    //  registering the device, the PAC is changed in the Sigfox portal</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE4">    //  but not in the Wisol AT Command.  You must get the updated</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE5">    //  PAC from the Sigfox portal if you wish to transfer the device.</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE6">    context.pac = response;</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE7">    debug(F(" - wisol.getPAC: "), context.pac);</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE8">    return true;</field>↵                                                                                                                                                                                                                                                                                                                                                                <field name="LINE9">}</field>↵                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function checkChannel(context: NetworkContext, response: string): boolean {" line1="    //  Parse the CMD_GET_CHANNEL response &quot;X,Y&quot; to determine if we need to send the CMD_RESET_CHANNEL command." line2="    //  If not needed, change the next command to CMD_NONE." line3="" line4="    //  CMD_GET_CHANNEL gets the current and next macro channel usage. Returns X,Y:" line5="    //  X: boolean value, indicating previous TX macro channel was in the Sigfox default channel" line6="    //  Y: number of micro channel available for next TX request in current macro channel." line7="" line8="    //  If X=0 or Y&lt;3, send CMD_RESET_CHANNEL to reset the device on the default Sigfox macro channel." line9="    //  Note: Don't use with a duty cycle less than 20 seconds.  //  debug(F(&quot;checkChannel: &quot;), response);" line10="    if (response.length &lt; 3) {  //  If too short, return error." line11="        debug(F(&quot;***** wisol.checkChannel Error: Unknown response &quot;), response);" line12="        return false;  //  Failure" line13="    }" line14="    //  Change chars to numbers." line15="    const x = response[0].charCodeAt(0) - '0'.charCodeAt(0);" line16="    const y = response[2].charCodeAt(0) - '0'.charCodeAt(0);" line17="    if (x != 0 &amp;&amp; y &gt;= 3) {" line18="        //  No need to reset channel. We change CMD_RESET_CHANNEL to CMD_NONE.  //  debug(F(&quot; - wisol.checkChannel: Continue channel&quot;));" line19="        let cmdIndex = context.cmdIndex;  //  Current index." line20="        cmdIndex++;  //  Next index, to be updated." line21="        if (cmdIndex &gt;= MAX_NETWORK_CMD_LIST_SIZE) {" line22="            debug(F(&quot;***** wisol.checkChannel Error: Cmd overflow&quot;));  //  List is full." line23="            return false;  //  Failure" line24="        }" line25="        if (context.cmdList[cmdIndex].sendData === null) {" line26="            debug(F(&quot;***** wisol.checkChannel Error: Empty cmd&quot;));  //  Not supposed to be empty." line27="            return false;  //  Failure" line28="        }" line29="        context.cmdList[cmdIndex].sendData = F(CMD_NONE);" line30="    } else {" line31="        //  Continue to send CMD_RESET_CHANNEL  //  debug(F(&quot; - wisol.checkChannel: Reset channel&quot;));" line32="    }" line33="    return true;  //  Success" line34="}" numlines="35"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function checkChannel(context: NetworkContext, response: string): boolean {</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    //  Parse the CMD_GET_CHANNEL response "X,Y" to determine if we need to send the CMD_RESET_CHANNEL command.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    //  If not needed, change the next command to CMD_NONE.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3"></field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE4">    //  CMD_GET_CHANNEL gets the current and next macro channel usage. Returns X,Y:</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE5">    //  X: boolean value, indicating previous TX macro channel was in the Sigfox default channel</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE6">    //  Y: number of micro channel available for next TX request in current macro channel.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE7"></field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE8">    //  If X=0 or Y&lt;3, send CMD_RESET_CHANNEL to reset the device on the default Sigfox macro channel.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE9">    //  Note: Don't use with a duty cycle less than 20 seconds.  //  debug(F("checkChannel: "), response);</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE10">    if (response.length &lt; 3) {  //  If too short, return error.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE11">        debug(F("***** wisol.checkChannel Error: Unknown response "), response);</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE12">        return false;  //  Failure</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE13">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE14">    //  Change chars to numbers.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE15">    const x = response[0].charCodeAt(0) - '0'.charCodeAt(0);</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE16">    const y = response[2].charCodeAt(0) - '0'.charCodeAt(0);</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE17">    if (x != 0 &amp;&amp; y &gt;= 3) {</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE18">        //  No need to reset channel. We change CMD_RESET_CHANNEL to CMD_NONE.  //  debug(F(" - wisol.checkChannel: Continue channel"));</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE19">        let cmdIndex = context.cmdIndex;  //  Current index.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE20">        cmdIndex++;  //  Next index, to be updated.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE21">        if (cmdIndex &gt;= MAX_NETWORK_CMD_LIST_SIZE) {</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE22">            debug(F("***** wisol.checkChannel Error: Cmd overflow"));  //  List is full.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE23">            return false;  //  Failure</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE24">        }</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE25">        if (context.cmdList[cmdIndex].sendData === null) {</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE26">            debug(F("***** wisol.checkChannel Error: Empty cmd"));  //  Not supposed to be empty.</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE27">            return false;  //  Failure</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE28">        }</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE29">        context.cmdList[cmdIndex].sendData = F(CMD_NONE);</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE30">    } else {</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE31">        //  Continue to send CMD_RESET_CHANNEL  //  debug(F(" - wisol.checkChannel: Reset channel"));</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE32">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE33">    return true;  //  Success</field>↵                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE34">}</field>↵                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function getDownlink(context: NetworkContext, response0: string): boolean {" line1="    //  Extract the downlink message and write into the context response." line2="    //  context response will be returned as an 8-byte hex string, e.g. &quot;0123456789ABCDEF&quot;" line3="    //  or a timeout error after 1 min e.g. &quot;ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT&quot;" line4="" line5="    //  Get a writeable response pointer in the uartContext." line6="    let response2 = context.uartContext.response;  // debug(F(&quot; - wisol.getDownlink: &quot;), response);" line7="" line8="    //  Check the original response." line9="    //  If Successful response: OK\nRX=01 23 45 67 89 AB CD EF" line10="    //  -&gt; Change response to: 0123456789ABCDEF" line11="    //  If Timeout response: ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT\n" line12="    //  -&gt; Remove newline: ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT" line13="" line14="    //  Remove the prefix and spaces:" line15="    //    replace &quot;OK\nRX=&quot; by &quot;&quot;, replace &quot; &quot; by &quot;&quot;" line16="    const downlinkPrefix = &quot;OK\nRX=&quot;;" line17="    let foundIndex = -1;" line18="    //  Implements: const foundIndex = response.indexOf(downlinkPrefix);" line19="    for (let k = 0; k + downlinkPrefix.length &lt;= response2.length; k++) {" line20="        if (response2.substr(k, downlinkPrefix.length) === downlinkPrefix) {" line21="            foundIndex = k;" line22="            break;" line23="        }" line24="    }" line25="    if (foundIndex &gt;= 0) {" line26="        //  Found the delimiter. Transform &lt;&lt;BEFORE&gt;&gt;OK\nRX=&lt;&lt;AFTER&gt;&gt;" line27="        //  To &lt;&lt;BEFORE&gt;&gt;&lt;&lt;AFTER&gt;&gt;" line28="        //  foundIndex points to &quot;OK\nRX=&quot;." line29="" line30="        //  Shift &lt;&lt;AFTER&gt;&gt; next to &lt;&lt;BEFORE&gt;&gt;." line31="        const after = response2.substr(foundIndex + downlinkPrefix.length);" line32="        response2 = response2.substr(0, foundIndex - 1) + after;" line33="    } else {" line34="        //  Return error e.g. ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT" line35="        context.status = false;" line36="    }" line37="    //  Remove all spaces." line38="    let src = 0, dst = 0;" line39="    let newResponse = &quot;&quot;;" line40="    for (; ;) {" line41="        if (src &gt;= MAX_UART_SEND_MSG_SIZE) break;" line42="        //  Don't copy spaces and newlines in the source." line43="        if (response2[src] === ' ' || response2[src] === '\n') {" line44="            src++;" line45="            continue;" line46="        }" line47="        //  Copy the character." line48="        newResponse = newResponse + response2[src];" line49="        //  If we have copied the terminating null, quit." line50="        ////if (dst &gt;= response.length) { break; }" line51="        dst++; src++;  //  Shift to next char." line52="    }" line53="    response2 = newResponse;" line54="    context.downlinkData = response2;" line55="    return true;" line56="}" numlines="57"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function getDownlink(context: NetworkContext, response0: string): boolean {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE1">    //  Extract the downlink message and write into the context response.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE2">    //  context response will be returned as an 8-byte hex string, e.g. "0123456789ABCDEF"</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE3">    //  or a timeout error after 1 min e.g. "ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT"</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE4"></field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE5">    //  Get a writeable response pointer in the uartContext.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE6">    let response2 = context.uartContext.response;  // debug(F(" - wisol.getDownlink: "), response);</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE7"></field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE8">    //  Check the original response.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE9">    //  If Successful response: OK\nRX=01 23 45 67 89 AB CD EF</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE10">    //  -&gt; Change response to: 0123456789ABCDEF</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE11">    //  If Timeout response: ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT\n</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE12">    //  -&gt; Remove newline: ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE13"></field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE14">    //  Remove the prefix and spaces:</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE15">    //    replace "OK\nRX=" by "", replace " " by ""</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE16">    const downlinkPrefix = "OK\nRX=";</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE17">    let foundIndex = -1;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE18">    //  Implements: const foundIndex = response.indexOf(downlinkPrefix);</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE19">    for (let k = 0; k + downlinkPrefix.length &lt;= response2.length; k++) {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE20">        if (response2.substr(k, downlinkPrefix.length) === downlinkPrefix) {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE21">            foundIndex = k;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE22">            break;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE23">        }</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE24">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE25">    if (foundIndex &gt;= 0) {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE26">        //  Found the delimiter. Transform &lt;&lt;BEFORE&gt;&gt;OK\nRX=&lt;&lt;AFTER&gt;&gt;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE27">        //  To &lt;&lt;BEFORE&gt;&gt;&lt;&lt;AFTER&gt;&gt;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE28">        //  foundIndex points to "OK\nRX=".</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE29"></field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE30">        //  Shift &lt;&lt;AFTER&gt;&gt; next to &lt;&lt;BEFORE&gt;&gt;.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE31">        const after = response2.substr(foundIndex + downlinkPrefix.length);</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE32">        response2 = response2.substr(0, foundIndex - 1) + after;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE33">    } else {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE34">        //  Return error e.g. ERR_SFX_ERR_SEND_FRAME_WAIT_TIMEOUT</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE35">        context.status = false;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE36">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE37">    //  Remove all spaces.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE38">    let src = 0, dst = 0;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE39">    let newResponse = "";</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE40">    for (; ;) {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE41">        if (src &gt;= MAX_UART_SEND_MSG_SIZE) break;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE42">        //  Don't copy spaces and newlines in the source.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE43">        if (response2[src] === ' ' || response2[src] === '\n') {</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE44">            src++;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE45">            continue;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE46">        }</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE47">        //  Copy the character.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE48">        newResponse = newResponse + response2[src];</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE49">        //  If we have copied the terminating null, quit.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE50">        ////if (dst &gt;= response.length) { break; }</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE51">        dst++; src++;  //  Shift to next char.</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE52">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE53">    response2 = newResponse;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE54">    context.downlinkData = response2;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE55">    return true;</field>↵                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE56">}</field>↵                                                                                                                                                                                                                                                                                                                                                                        <comment pinned="false" h="120" w="160">Downlink Server Support: https://backend.sigfox.com/apidocs/callback When a message needs to be acknowledged, the callback selected for the downlink data must send data in the response. It must contain the 8 bytes data that will be sent to the device asking for acknowledgment. The data is json formatted, and must be structured as the following : {"YOUR_DEVICE_ID" : { "downlinkData" : "deadbeefcafebabe"}} With YOUR_DEVICE_ID being replaced by the corresponding device id, in hexadecimal format, up to 8 digits. The downlink data must be 8 bytes in hexadecimal format.  For example: {"002C2EA1" : { "downlinkData" : "0102030405060708"}}</comment>↵                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="let uartData: string;" numlines="1" declaredvars="uartData"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">let uartData: string;</field>↵                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="let cmdData: string;" numlines="1" declaredvars="cmdData"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">let cmdData: string;</field>↵                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function convertCmdToUART(" line1="    cmd: NetworkCmd," line2="    context: NetworkContext," line3="    uartMsg: UARTMsg," line4="    successEvent0: Evt_t," line5="    failureEvent0: Evt_t," line6="    responseMsg: SensorMsg," line7="    responseTaskID: number): void {" line8="    //  Convert the Wisol command into a UART message." line9="    uartData = &quot;&quot;;  //  Clear the dest buffer." line10="    uartMsg.timeout = COMMAND_TIMEOUT;" line11="    uartMsg.responseMsg = null;" line12="" line13="    if (cmd.sendData) {" line14="        //  Append sendData if it exists." line15="        cmdData = cmd.sendData;" line16="        const cmdDataStr = cmdData;" line17="        uartData = cmdDataStr;  //  Copy the command string." line18="    }" line19="    if (cmd.payload) {" line20="        //  Append payload if it exists." line21="        uartData = uartData + cmd.payload;" line22="        uartMsg.timeout = UPLINK_TIMEOUT;  //  Increase timeout for uplink." line23="        //  If there is payload to send, send the response message when sending is completed." line24="        uartMsg.responseMsg = responseMsg;" line25="        uartMsg.responseTaskID = responseTaskID;" line26="    }" line27="    if (cmd.sendData2) {" line28="        //  Append sendData2 if it exists.  Need to use String class because sendData is in flash memory." line29="        cmdData = cmd.sendData2;" line30="        const cmdDataStr2 = cmdData;" line31="        uartData = uartData + cmdDataStr2;" line32="        uartMsg.timeout = DOWNLINK_TIMEOUT;  //  Increase timeout for downlink." line33="    }" line34="    //  Terminate the command with &quot;\r&quot;." line35="    uartData = uartData + CMD_END;" line36="    //  Check total msg length." line37="    if (uartData.length &gt;= MAX_UART_SEND_MSG_SIZE - 1) {" line38="        debug_print(F(&quot;***** Error: uartData overflow - &quot;)); debug_print(uartData.length + &quot;&quot;);" line39="        debug_print(&quot; / &quot;); debug_println(uartData); debug_flush();" line40="    }" line41="    uartMsg.markerChar = END_OF_RESPONSE;" line42="    uartMsg.expectedMarkerCount = cmd.expectedMarkerCount;" line43="    uartMsg.successEvent = successEvent0;" line44="    uartMsg.failureEvent = failureEvent0;" line45="    uartMsg.sendData = uartData;" line46="}" numlines="47"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function convertCmdToUART(</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    cmd: NetworkCmd,</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    context: NetworkContext,</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3">    uartMsg: UARTMsg,</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE4">    successEvent0: Evt_t,</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE5">    failureEvent0: Evt_t,</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE6">    responseMsg: SensorMsg,</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE7">    responseTaskID: number): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE8">    //  Convert the Wisol command into a UART message.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE9">    uartData = "";  //  Clear the dest buffer.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE10">    uartMsg.timeout = COMMAND_TIMEOUT;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE11">    uartMsg.responseMsg = null;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE12"></field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE13">    if (cmd.sendData) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE14">        //  Append sendData if it exists.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE15">        cmdData = cmd.sendData;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE16">        const cmdDataStr = cmdData;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE17">        uartData = cmdDataStr;  //  Copy the command string.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE18">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE19">    if (cmd.payload) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE20">        //  Append payload if it exists.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE21">        uartData = uartData + cmd.payload;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE22">        uartMsg.timeout = UPLINK_TIMEOUT;  //  Increase timeout for uplink.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE23">        //  If there is payload to send, send the response message when sending is completed.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE24">        uartMsg.responseMsg = responseMsg;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE25">        uartMsg.responseTaskID = responseTaskID;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE26">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE27">    if (cmd.sendData2) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE28">        //  Append sendData2 if it exists.  Need to use String class because sendData is in flash memory.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE29">        cmdData = cmd.sendData2;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE30">        const cmdDataStr2 = cmdData;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE31">        uartData = uartData + cmdDataStr2;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE32">        uartMsg.timeout = DOWNLINK_TIMEOUT;  //  Increase timeout for downlink.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE33">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE34">    //  Terminate the command with "\r".</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE35">    uartData = uartData + CMD_END;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE36">    //  Check total msg length.</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE37">    if (uartData.length &gt;= MAX_UART_SEND_MSG_SIZE - 1) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE38">        debug_print(F("***** Error: uartData overflow - ")); debug_print(uartData.length + "");</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE39">        debug_print(" / "); debug_println(uartData); debug_flush();</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE40">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE41">    uartMsg.markerChar = END_OF_RESPONSE;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE42">    uartMsg.expectedMarkerCount = cmd.expectedMarkerCount;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE43">    uartMsg.successEvent = successEvent0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE44">    uartMsg.failureEvent = failureEvent0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE45">    uartMsg.sendData = uartData;</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE46">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function setup_wisol(" line1="    context: NetworkContext," line2="    uartContext: UARTContext," line3="    uartTaskID: number," line4="    country0: Country," line5="    useEmulator0: boolean): void {" line6="    //  Init the Wisol context." line7="    /*" line8="    const maxCount = 10;  //  Allow up to 10 tasks to queue for aggregating and sending sensor data." line9="    const initValue = 1;  //  Allow only 1 concurrent task for aggregating and sending sensor data." line10="    sendSemaphore = sem_counting_create(maxCount, initValue);" line11="    */" line12="    context.uartContext = uartContext;" line13="    context.uartTaskID = uartTaskID;" line14="    context.country = country0;" line15="    context.useEmulator = useEmulator0;" line16="    context.stepBeginFunc = getStepBegin;" line17="    context.stepSendFunc = getStepSend;" line18="    context.device = &quot;&quot;;  //  Clear the device ID." line19="    context.pac = &quot;&quot;;     //  Clear the PAC code." line20="    context.zone = context.country &amp; RCZ_MASK;  //  Extract the zone from country node." line21="    context.lastSend = millis() + SEND_INTERVAL + SEND_INTERVAL;  //  Init the last send time to a high number so that sensor data will wait for Begin Step to complete." line22="    context.pendingResponse = false;" line23="" line24="    //  Populate the command list." line25="    cmdList = [];" line26="    for (let l = 0; l &lt; MAX_NETWORK_CMD_LIST_SIZE; l++) {" line27="        let cmd2: NetworkCmd = {" line28="            sendData: null," line29="            expectedMarkerCount: 0," line30="            processFunc: null," line31="            payload: null," line32="            sendData2: null," line33="        };" line34="        cmdList.push(cmd2);" line35="    }" line36="" line37="    //  Init the UART message." line38="    uartMsg = {" line39="        sendData: null," line40="        timeout: 0," line41="        markerChar: 0," line42="        expectedMarkerCount: 0," line43="        successEvent: null," line44="        failureEvent: null," line45="        responseMsg: null," line46="        responseTaskID: 0," line47="    };" line48="}" numlines="49"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function setup_wisol(</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE1">    context: NetworkContext,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE2">    uartContext: UARTContext,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE3">    uartTaskID: number,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE4">    country0: Country,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE5">    useEmulator0: boolean): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE6">    //  Init the Wisol context.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE7">    /*</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE8">    const maxCount = 10;  //  Allow up to 10 tasks to queue for aggregating and sending sensor data.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE9">    const initValue = 1;  //  Allow only 1 concurrent task for aggregating and sending sensor data.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE10">    sendSemaphore = sem_counting_create(maxCount, initValue);</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE11">    */</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE12">    context.uartContext = uartContext;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE13">    context.uartTaskID = uartTaskID;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE14">    context.country = country0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE15">    context.useEmulator = useEmulator0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE16">    context.stepBeginFunc = getStepBegin;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE17">    context.stepSendFunc = getStepSend;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE18">    context.device = "";  //  Clear the device ID.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE19">    context.pac = "";     //  Clear the PAC code.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE20">    context.zone = context.country &amp; RCZ_MASK;  //  Extract the zone from country node.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE21">    context.lastSend = millis() + SEND_INTERVAL + SEND_INTERVAL;  //  Init the last send time to a high number so that sensor data will wait for Begin Step to complete.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE22">    context.pendingResponse = false;</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE23"></field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE24">    //  Populate the command list.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE25">    cmdList = [];</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE26">    for (let l = 0; l &lt; MAX_NETWORK_CMD_LIST_SIZE; l++) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE27">        let cmd2: NetworkCmd = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE28">            sendData: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE29">            expectedMarkerCount: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE30">            processFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE31">            payload: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE32">            sendData2: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE33">        };</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE34">        cmdList.push(cmd2);</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE35">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE36"></field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE37">    //  Init the UART message.</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE38">    uartMsg = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE39">        sendData: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE40">        timeout: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE41">        markerChar: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE42">        expectedMarkerCount: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE43">        successEvent: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE44">        failureEvent: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE45">        responseMsg: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE46">        responseTaskID: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE47">    };</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE48">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function addCmd(list: Array&lt;NetworkCmd&gt;, listSize: number, cmd: NetworkCmd): void {" line1="    //  Append the UART message to the command list." line2="    //  Stop if we have overflowed the list." line3="    let m = getCmdIndex(list, listSize);" line4="    list[m++] = cmd;" line5="    list[m++] = endOfList;" line6="}" numlines="7"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function addCmd(list: Array&lt;NetworkCmd&gt;, listSize: number, cmd: NetworkCmd): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE1">    //  Append the UART message to the command list.</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE2">    //  Stop if we have overflowed the list.</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE3">    let m = getCmdIndex(list, listSize);</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE4">    list[m++] = cmd;</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE5">    list[m++] = endOfList;</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE6">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function getCmdIndex(list: Array&lt;NetworkCmd&gt;, listSize: number): number {" line1="    //  Given a list of commands, return the index of the next empty element." line2="    //  Check index against cmd size.  It must fit 2 more elements:" line3="    //  The new cmd and the endOfList cmd." line4="    let n = 0;" line5="    for (n = 0;  //  Search all elements in list." line6="        list[n].sendData &amp;&amp;   //  Skip no-empty elements." line7="        n &lt; listSize - 1;  //  Don't exceed the list size." line8="        n++) { }" line9="    if (n &gt;= listSize - 1) {" line10="        //  List is full." line11="        debug_print(F(&quot;***** Error: Cmd list overflow - &quot;)); debug_println(n + &quot;&quot;); debug_flush();" line12="        n = listSize - 2;" line13="        if (n &lt; 0) n = 0;" line14="    }" line15="    return n;" line16="}" numlines="17"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function getCmdIndex(list: Array&lt;NetworkCmd&gt;, listSize: number): number {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    //  Given a list of commands, return the index of the next empty element.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    //  Check index against cmd size.  It must fit 2 more elements:</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">    //  The new cmd and the endOfList cmd.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE4">    let n = 0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE5">    for (n = 0;  //  Search all elements in list.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE6">        list[n].sendData &amp;&amp;   //  Skip no-empty elements.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE7">        n &lt; listSize - 1;  //  Don't exceed the list size.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE8">        n++) { }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE9">    if (n &gt;= listSize - 1) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE10">        //  List is full.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE11">        debug_print(F("***** Error: Cmd list overflow - ")); debug_println(n + ""); debug_flush();</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE12">        n = listSize - 2;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE13">        if (n &lt; 0) n = 0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE14">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE15">    return n;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE16">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function createSensorMsg(name: string, value?: number): SensorMsg {" line1="    //  Populate the msg fields as an empty message." line2="    let msg2: SensorMsg = {" line3="        name: name," line4="        count: 0,  //  No data." line5="        data: []," line6="    };" line7="    if (value !== null) {" line8="        msg2.count = 1;" line9="        msg2.data = [value];" line10="    }" line11="    return msg2;" line12="}" numlines="13"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function createSensorMsg(name: string, value?: number): SensorMsg {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    //  Populate the msg fields as an empty message.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    let msg2: SensorMsg = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3">        name: name,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE4">        count: 0,  //  No data.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE5">        data: [],</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE6">    };</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE7">    if (value !== null) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE8">        msg2.count = 1;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE9">        msg2.data = [value];</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE10">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE11">    return msg2;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE12">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                      <block type="variables_set">↵                                                                                                                                                                                                                                                                                                                                                                                                        <field name="VAR" id="ww%Z^66cWiXBs7j)FOGK" variabletype="">PAYLOAD_SIZE</field>↵                                                                                                                                                                                                                                                                                                                                                                                                        <comment pinned="false" h="120" w="160">Buffer for constructing the message payload to be sent, in hex digits, plus terminating null.</comment>↵                                                                                                                                                                                                                                                                                                                                                                                                        <value name="VALUE">↵                                                                                                                                                                                                                                                                                                                                                                                                          <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                          <block type="math_arithmetic">↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="OP">ADD</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <value name="A">↵                                                                                                                                                                                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="NUM">1</field>↵                                                                                                                                                                                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                                                                                                                                                                                            <value name="B">↵                                                                                                                                                                                                                                                                                                                                                                                                              <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                              <block type="math_arithmetic">↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <value name="A">↵                                                                                                                                                                                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="NUM">0</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="variables_get">↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="VAR" id="@3653$8`ouBkRFm^?:`!" variabletype="">MAX_MESSAGE_SIZE</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                                                                                                                                                                                <value name="B">↵                                                                                                                                                                                                                                                                                                                                                                                                                  <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="NUM">2</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                  </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function aggregate_sensor_data(" line1="    context: NetworkContext,  //  Context storage for the Network Task." line2="    msg: SensorMsg,           //  Sensor Data Message just received. Contains sensor name and sensor values." line3="    cmdList: NetworkCmd[],    //  Upon return, will be populated by the list of AT Commands to be executed." line4="    cmdListSize: number): boolean {        //  How many commands may be stored in cmdList." line5="    //  Aggregate the received sensor data.  Check whether we should send the data, based on " line6="    //  the throttle settings.  Return true if we should send the message.  The message commands are" line7="    //  populated in cmdList, up to cmdListSize elements (including the terminating command)." line8="    led_toggle();  //  Blink the LED so we know we are aggregating continuously." line9="    if (msg.name === BEGIN_SENSOR_NAME) {" line10="        //  If sensor name is &quot;000&quot;, this is the Begin Step." line11="        const beginArgs: StepArgs = {" line12="            list: cmdList," line13="            listSize: cmdListSize," line14="            payload: &quot;&quot;," line15="            enableDownlink: ENABLE_DOWNLINK," line16="        };" line17="        context.stepBeginFunc(context, beginArgs);  //  Fetch list of startup commands for the transceiver." line18="        return true;  //  Send the startup commands." line19="    }" line20="    debug_print(msg.name); debug_print(F(&quot; &lt;&lt; Recv data &quot;));" line21="    if (msg.count &gt; 0) { debug_println(msg.data[0] + &quot;&quot;); }" line22="    else { debug_println(&quot;(empty)&quot;); }" line23="    //  debug_flush();" line24="" line25="    //  Aggregate the sensor data.  Here we just save the last value for each sensor." line26="    let savedSensor: SensorMsg = recallSensor(msg.name);" line27="    debug(msg.name, &quot;1a&quot;); ////" line28="    if (!savedSensor) return false;  //  Return error." line29="    debug(msg.name, &quot;1b&quot;); ////" line30="    copySensorData(savedSensor, msg);  //  Copy the data from the received message into the saved data." line31="    debug(msg.name, &quot;1c&quot;); ////" line32="" line33="    //  Throttle the sending.  TODO: Show warning if messages are sent faster than SEND_DELAY." line34="    let now = millis();" line35="    if ((context.lastSend + SEND_INTERVAL) &gt; now) { return false; }  //  Not ready to send." line36="    context.lastSend = now + MAX_TIMEOUT;  //  Prevent other requests from trying to send." line37="    debug(msg.name, &quot;2&quot;); ////" line38="" line39="    //  Create a new Sigfox message. Add a running sequence number to the message." line40="    payload = &quot;&quot;;  //  Empty the message payload." line41="    let sequenceNumber = 0;" line42="    payload = addPayloadInt(payload, PAYLOAD_SIZE, &quot;seq&quot;, sequenceNumber++, 4);" line43="    debug(msg.name, &quot;3&quot;); ////" line44="" line45="    //  Encode the sensor data into a Sigfox message, 4 digits each." line46="    const sendSensors = [&quot;tmp&quot;, &quot;hmd&quot;, &quot;alt&quot;];  //  Sensors to be sent." line47="    sendSensors.forEach((sensorName: string) =&gt; {" line48="        //  Get each sensor data and add to the message payload." line49="        let data = 0.0;" line50="        savedSensor = recallSensor(sensorName);  //  Find the sensor." line51="        if (savedSensor &amp;&amp; savedSensor.count &gt; 0) { data = savedSensor.data[0]; }  //  Fetch the sensor data (first float only)." line52="        const scaledData = data * 10.0;  //  Scale up by 10 to send 1 decimal place. So 27.1 becomes 271" line53="        payload = addPayloadInt(payload, PAYLOAD_SIZE, sensorName, scaledData, 4);  //  Add to payload.        " line54="    })" line55="    debug(msg.name, &quot;4&quot;); ////" line56="" line57="    //  If the payload has odd number of digits, pad with '0'." line58="    const length = payload.length;" line59="    if (length % 2 != 0 &amp;&amp; length &lt; PAYLOAD_SIZE - 1) {" line60="        payload = payload + '0';" line61="    }" line62="    debug_print(F(&quot;agg &gt;&gt; Send &quot;)); debug_println(payload);" line63="" line64="    //  Compose the list of Wisol AT Commands for sending the message payload." line65="    const sendArgs: StepArgs = {" line66="        list: cmdList," line67="        listSize: cmdListSize," line68="        payload: payload," line69="        enableDownlink: ENABLE_DOWNLINK," line70="    };" line71="    context.stepSendFunc(context, sendArgs);" line72="    return true;  //  Will be sent by the caller." line73="}" numlines="74"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function aggregate_sensor_data(</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE1">    context: NetworkContext,  //  Context storage for the Network Task.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE2">    msg: SensorMsg,           //  Sensor Data Message just received. Contains sensor name and sensor values.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE3">    cmdList: NetworkCmd[],    //  Upon return, will be populated by the list of AT Commands to be executed.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE4">    cmdListSize: number): boolean {        //  How many commands may be stored in cmdList.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE5">    //  Aggregate the received sensor data.  Check whether we should send the data, based on </field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE6">    //  the throttle settings.  Return true if we should send the message.  The message commands are</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE7">    //  populated in cmdList, up to cmdListSize elements (including the terminating command).</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE8">    led_toggle();  //  Blink the LED so we know we are aggregating continuously.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE9">    if (msg.name === BEGIN_SENSOR_NAME) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE10">        //  If sensor name is "000", this is the Begin Step.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE11">        const beginArgs: StepArgs = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE12">            list: cmdList,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE13">            listSize: cmdListSize,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE14">            payload: "",</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE15">            enableDownlink: ENABLE_DOWNLINK,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE16">        };</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE17">        context.stepBeginFunc(context, beginArgs);  //  Fetch list of startup commands for the transceiver.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE18">        return true;  //  Send the startup commands.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE19">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE20">    debug_print(msg.name); debug_print(F(" &lt;&lt; Recv data "));</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE21">    if (msg.count &gt; 0) { debug_println(msg.data[0] + ""); }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE22">    else { debug_println("(empty)"); }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE23">    //  debug_flush();</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE24"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE25">    //  Aggregate the sensor data.  Here we just save the last value for each sensor.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE26">    let savedSensor: SensorMsg = recallSensor(msg.name);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE27">    debug(msg.name, "1a"); ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE28">    if (!savedSensor) return false;  //  Return error.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE29">    debug(msg.name, "1b"); ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE30">    copySensorData(savedSensor, msg);  //  Copy the data from the received message into the saved data.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE31">    debug(msg.name, "1c"); ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE32"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE33">    //  Throttle the sending.  TODO: Show warning if messages are sent faster than SEND_DELAY.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE34">    let now = millis();</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE35">    if ((context.lastSend + SEND_INTERVAL) &gt; now) { return false; }  //  Not ready to send.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE36">    context.lastSend = now + MAX_TIMEOUT;  //  Prevent other requests from trying to send.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE37">    debug(msg.name, "2"); ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE38"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE39">    //  Create a new Sigfox message. Add a running sequence number to the message.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE40">    payload = "";  //  Empty the message payload.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE41">    let sequenceNumber = 0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE42">    payload = addPayloadInt(payload, PAYLOAD_SIZE, "seq", sequenceNumber++, 4);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE43">    debug(msg.name, "3"); ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE44"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE45">    //  Encode the sensor data into a Sigfox message, 4 digits each.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE46">    const sendSensors = ["tmp", "hmd", "alt"];  //  Sensors to be sent.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE47">    sendSensors.forEach((sensorName: string) =&gt; {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE48">        //  Get each sensor data and add to the message payload.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE49">        let data = 0.0;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE50">        savedSensor = recallSensor(sensorName);  //  Find the sensor.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE51">        if (savedSensor &amp;&amp; savedSensor.count &gt; 0) { data = savedSensor.data[0]; }  //  Fetch the sensor data (first float only).</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE52">        const scaledData = data * 10.0;  //  Scale up by 10 to send 1 decimal place. So 27.1 becomes 271</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE53">        payload = addPayloadInt(payload, PAYLOAD_SIZE, sensorName, scaledData, 4);  //  Add to payload.        </field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE54">    })</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE55">    debug(msg.name, "4"); ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE56"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE57">    //  If the payload has odd number of digits, pad with '0'.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE58">    const length = payload.length;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE59">    if (length % 2 != 0 &amp;&amp; length &lt; PAYLOAD_SIZE - 1) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE60">        payload = payload + '0';</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE61">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE62">    debug_print(F("agg &gt;&gt; Send ")); debug_println(payload);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE63"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE64">    //  Compose the list of Wisol AT Commands for sending the message payload.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE65">    const sendArgs: StepArgs = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE66">        list: cmdList,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE67">        listSize: cmdListSize,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE68">        payload: payload,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE69">        enableDownlink: ENABLE_DOWNLINK,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE70">    };</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE71">    context.stepSendFunc(context, sendArgs);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE72">    return true;  //  Will be sent by the caller.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE73">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                            <comment pinned="false" h="120" w="160">const testPayload = "0102030405060708090a0b0c";  // For testing</comment>↵                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function addPayloadInt(" line1="    payloadBuffer: string," line2="    payloadSize: number," line3="    name: string," line4="    data: number," line5="    numDigits: number): string {" line6="    //  Add the integer data to the message payload as numDigits digits in hexadecimal." line7="    //  So data=1234 and numDigits=4, it will be added as &quot;1234&quot;.  Not efficient, but easy to read." line8="    const length2 = payloadBuffer.length;" line9="    if (length2 + numDigits &gt;= payloadSize) {  //  No space for numDigits hex digits." line10="        debug(F(&quot;***** Error: No payload space for &quot;), name);" line11="        return payloadBuffer;" line12="    }" line13="    if (data &lt; 0 || data &gt;= Math.pow(10, numDigits)) {  //  Show a warning if out of range." line14="        debug_print(F(&quot;***** Warning: Only last &quot;)); debug_print(numDigits + &quot;&quot;);" line15="        debug_print(F(&quot; digits of &quot;)); debug_print(name); debug_print(F(&quot; value &quot;)); debug_print(data + &quot;&quot;);" line16="        debug_println(&quot; will be sent&quot;); // debug_flush();" line17="    }" line18="    for (let o = numDigits - 1; o &gt;= 0; o--) {  //  Add the digits in reverse order (right to left)." line19="        const d = data % 10;  //  Take the last digit." line20="        data = data / 10;  //  Shift to the next digit." line21="        //  payloadBuffer[length + i] = '0' + d;  //  Write the digit to payload: 1 becomes '1'." line22="        payloadBuffer = payloadBuffer + String.fromCharCode(" line23="            '0'.charCodeAt(0) + d);  //  Write the digit to payload: 1 becomes '1'." line24="    }" line25="    return payloadBuffer;" line26="}" numlines="27"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function addPayloadInt(</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    payloadBuffer: string,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    payloadSize: number,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">    name: string,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE4">    data: number,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE5">    numDigits: number): string {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE6">    //  Add the integer data to the message payload as numDigits digits in hexadecimal.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE7">    //  So data=1234 and numDigits=4, it will be added as "1234".  Not efficient, but easy to read.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE8">    const length2 = payloadBuffer.length;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE9">    if (length2 + numDigits &gt;= payloadSize) {  //  No space for numDigits hex digits.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE10">        debug(F("***** Error: No payload space for "), name);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE11">        return payloadBuffer;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE12">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE13">    if (data &lt; 0 || data &gt;= Math.pow(10, numDigits)) {  //  Show a warning if out of range.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE14">        debug_print(F("***** Warning: Only last ")); debug_print(numDigits + "");</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE15">        debug_print(F(" digits of ")); debug_print(name); debug_print(F(" value ")); debug_print(data + "");</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE16">        debug_println(" will be sent"); // debug_flush();</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE17">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE18">    for (let o = numDigits - 1; o &gt;= 0; o--) {  //  Add the digits in reverse order (right to left).</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE19">        const d = data % 10;  //  Take the last digit.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE20">        data = data / 10;  //  Shift to the next digit.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE21">        //  payloadBuffer[length + i] = '0' + d;  //  Write the digit to payload: 1 becomes '1'.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE22">        payloadBuffer = payloadBuffer + String.fromCharCode(</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE23">            '0'.charCodeAt(0) + d);  //  Write the digit to payload: 1 becomes '1'.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE24">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE25">    return payloadBuffer;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE26">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function copySensorData(dest: SensorMsg, src: SensorMsg): void {" line1="    //  Copy sensor data from src to dest." line2="    dest.data = [];" line3="    for (let p = 0; p &lt; src.count; p++) {" line4="        dest.data.push(src.data[p]);" line5="    }" line6="    dest.count = src.count;" line7="}" numlines="8"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function copySensorData(dest: SensorMsg, src: SensorMsg): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    //  Copy sensor data from src to dest.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    dest.data = [];</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3">    for (let p = 0; p &lt; src.count; p++) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE4">        dest.data.push(src.data[p]);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE5">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE6">    dest.count = src.count;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE7">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function recallSensor(name: string): SensorMsg {" line1="    //  Return the sensor data for the sensor name.  If not found, allocate" line2="    //  a new SensorMsg and return it.  If no more space, return NULL." line3="    let emptyIndex = -1;" line4="    for (let q = 0; q &lt; MAX_SENSOR_COUNT; q++) {" line5="        //  Search for the sensor name in our data." line6="        if (name === sensorData[q].name) {" line7="            return sensorData[q];  //  Found it." line8="        }" line9="        //  Find the first empty element." line10="        if (emptyIndex == -1 &amp;&amp; sensorData[q].name === &quot;&quot;) {" line11="            emptyIndex = q;" line12="        }" line13="    }" line14="    //  Allocate a new element." line15="    if (emptyIndex == -1) {  //  No more space." line16="        debug(F(&quot;***** Error: No aggregate space for &quot;), name);" line17="        return null;" line18="    }" line19="    sensorData[emptyIndex].name = name;" line20="    sensorData[emptyIndex].count = 0;  //  Clear the values." line21="    sensorData[emptyIndex].data = [];  //  Reset to empty in case we need to send." line22="    return sensorData[emptyIndex];" line23="}" numlines="24"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function recallSensor(name: string): SensorMsg {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE1">    //  Return the sensor data for the sensor name.  If not found, allocate</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE2">    //  a new SensorMsg and return it.  If no more space, return NULL.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE3">    let emptyIndex = -1;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE4">    for (let q = 0; q &lt; MAX_SENSOR_COUNT; q++) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE5">        //  Search for the sensor name in our data.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE6">        if (name === sensorData[q].name) {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE7">            return sensorData[q];  //  Found it.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE8">        }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE9">        //  Find the first empty element.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE10">        if (emptyIndex == -1 &amp;&amp; sensorData[q].name === "") {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE11">            emptyIndex = q;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE12">        }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE13">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE14">    //  Allocate a new element.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE15">    if (emptyIndex == -1) {  //  No more space.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE16">        debug(F("***** Error: No aggregate space for "), name);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE17">        return null;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE18">    }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE19">    sensorData[emptyIndex].name = name;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE20">    sensorData[emptyIndex].count = 0;  //  Clear the values.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE21">    sensorData[emptyIndex].data = [];  //  Reset to empty in case we need to send.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE22">    return sensorData[emptyIndex];</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE23">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function process_downlink_msg(" line1="    context: NetworkContext,  //  Task context." line2="    status: boolean,          //  True if downlink was received." line3="    data: string): boolean {  //  Downlink data (up to 8 bytes in hex e.g. &quot;0102030405060708&quot;) or error name." line4="    if (status) { debug(F(&quot; - process_downlink_msg: &quot;), data); }" line5="    else { debug(F(&quot; - process_downlink_msg (Failed): &quot;), data); }" line6="" line7="    //  TODO: Add your code here to process the downlink message." line8="    return true;  //  Means no error." line9="}" numlines="10"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function process_downlink_msg(</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE1">    context: NetworkContext,  //  Task context.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE2">    status: boolean,          //  True if downlink was received.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE3">    data: string): boolean {  //  Downlink data (up to 8 bytes in hex e.g. "0102030405060708") or error name.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE4">    if (status) { debug(F(" - process_downlink_msg: "), data); }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE5">    else { debug(F(" - process_downlink_msg (Failed): "), data); }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE6"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE7">    //  TODO: Add your code here to process the downlink message.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE8">    return true;  //  Means no error.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE9">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <comment pinned="false" h="120" w="160">From downlink.cpp</comment>↵                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function setup_uart(" line1="    context: UARTContext,  //  Will be used to store the context of the UART Task." line2="    response: string): void {      //  Buffer that will be used to store the UART response." line3="    //  Init the UART context with the response buffer." line4="    context.response = response;" line5="}" numlines="6"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function setup_uart(</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    context: UARTContext,  //  Will be used to store the context of the UART Task.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    response: string): void {      //  Buffer that will be used to store the UART response.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">    //  Init the UART context with the response buffer.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE4">    context.response = response;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE5">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <comment pinned="false" h="120" w="160">From uart.cpp</comment>↵                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="let uartContext: UARTContext = {" line1="    status: false," line2="    sendIndex: 0," line3="    sentTime: 0," line4="    response: null," line5="    actualMarkerCount: 0," line6="    testTimer: 0," line7="    msg: null," line8="}" numlines="9" declaredvars="uartContext"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">let uartContext: UARTContext = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    status: false,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    sendIndex: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3">    sentTime: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE4">    response: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE5">    actualMarkerCount: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE6">    testTimer: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE7">    msg: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE8">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <comment pinned="false" h="120" w="160">TODO</comment>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="let wisolContext: NetworkContext = {" line1="    uartContext: null," line2="    uartTaskID: 0," line3="    zone: 0," line4="    country: Country.COUNTRY_SG," line5="    useEmulator: false," line6="    stepBeginFunc: null," line7="    stepSendFunc: null," line8="" line9="    device: null," line10="    pac: null," line11="    status: false," line12="    pendingResponse: false," line13="    pendingProcessFunc: null," line14="    lastSend: 0," line15="    msg: null," line16="    downlinkData: null," line17="" line18="    cmdList: null," line19="    cmdIndex: 0," line20="};" numlines="21" declaredvars="wisolContext"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">let wisolContext: NetworkContext = {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE1">    uartContext: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE2">    uartTaskID: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE3">    zone: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE4">    country: Country.COUNTRY_SG,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE5">    useEmulator: false,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE6">    stepBeginFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE7">    stepSendFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE8"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE9">    device: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE10">    pac: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE11">    status: false,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE12">    pendingResponse: false,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE13">    pendingProcessFunc: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE14">    lastSend: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE15">    msg: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE16">    downlinkData: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE17"></field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE18">    cmdList: null,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE19">    cmdIndex: 0,</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE20">};</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function ctx(): NetworkContext { return wisolContext; }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function ctx(): NetworkContext { return wisolContext; }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="interface Sem_t { }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">interface Sem_t { }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0=";" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function sem_wait(sem: Sem_t): void { }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function sem_wait(sem: Sem_t): void { }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function sem_signal(sem: Sem_t): void { }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function sem_signal(sem: Sem_t): void { }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function event_create(): Evt_t { return {}; }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function event_create(): Evt_t { return {}; }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function event_wait_multiple(mode: number, event1: Evt_t, event2: Evt_t): void { }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function event_wait_multiple(mode: number, event1: Evt_t, event2: Evt_t): void { }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function os_get_running_tid(): number { return 2205; }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function os_get_running_tid(): number { return 2205; }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function msg_receive(task_id: number, msg: SensorMsg): void {" line1="    //  TODO" line2="}" numlines="3"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function msg_receive(task_id: number, msg: SensorMsg): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE1">    //  TODO</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE2">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function msg_post(task_id: number, msg: UARTMsg): void {" line1="    //  TODO" line2="    debug(&quot;&gt;&gt; msg_post &quot;, msg.sendData)" line3="    serial.redirect(SerialPin.P0, SerialPin.P1, 9600)" line4="    serial.writeString(msg.sendData)" line5="    uartContext.response = &quot;OK&quot;; ////" line6="    //// uartContext.response = serial.readUntil(String.fromCharCode(msg.markerChar))" line7="    serial.redirectToUSB()" line8="    uartContext.status = true;" line9="}" numlines="10"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function msg_post(task_id: number, msg: UARTMsg): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    //  TODO</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    debug("&gt;&gt; msg_post ", msg.sendData)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">    serial.redirect(SerialPin.P0, SerialPin.P1, 9600)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE4">    serial.writeString(msg.sendData)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE5">    uartContext.response = "OK"; ////</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE6">    //// uartContext.response = serial.readUntil(String.fromCharCode(msg.markerChar))</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE7">    serial.redirectToUSB()</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE8">    uartContext.status = true;</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE9">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function debug_print(p1: string, p2?: string): void {" line1="    serial.writeString(p1)" line2="    if (p2 !== null) { serial.writeString(p2) }" line3="}" numlines="4"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function debug_print(p1: string, p2?: string): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE1">    serial.writeString(p1)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE2">    if (p2 !== null) { serial.writeString(p2) }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE3">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="function debug_println(p1: string, p2?: string): void {" line1="    debug_print(p1, p2);" line2="    serial.writeLine(&quot;&quot;);" line3="}" numlines="4"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">function debug_println(p1: string, p2?: string): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE1">    debug_print(p1, p2);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE2">    serial.writeLine("");</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE3">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="function debug(p1: string, p2?: string): void {" line1="    debug_println(p1, p2);" line2="}" numlines="3"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">function debug(p1: string, p2?: string): void {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE1">    debug_println(p1, p2);</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE2">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <mutation line0="function millis(): int32 {" line1="    //  Number of seconds elapsed since power on." line2="    return input.runningTime()" line3="}" numlines="4"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE0">function millis(): int32 {</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE1">    //  Number of seconds elapsed since power on.</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE2">    return input.runningTime()</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="LINE3">}</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="function F(s: string): string { return s; }" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">function F(s: string): string { return s; }</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="serial_writeline">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <value name="text">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <shadow type="text">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="TEXT">line1</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </value>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="serial_writeline">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <value name="text">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <shadow type="text">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="TEXT">line2</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </value>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="procedures_callnoreturn">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <mutation name="setup_aggregate"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <field name="NAME">setup_aggregate</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <comment pinned="false" h="120" w="160">Erase the aggregated sensor data.</comment>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="procedures_callnoreturn">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation name="network_setup"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="NAME">network_setup</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="const beginMsg = createSensorMsg(BEGIN_SENSOR_NAME)" numlines="1" declaredvars="beginMsg"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">const beginMsg = createSensorMsg(BEGIN_SENSOR_NAME)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <mutation line0="network_task(beginMsg)" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <field name="LINE0">network_task(beginMsg)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <block type="device_pause">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <value name="pause">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <shadow type="timePicker"></shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="math_arithmetic">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="OP">MULTIPLY</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <value name="A">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="NUM">20</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <value name="B">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <shadow type="math_number">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="NUM">1000</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </shadow>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </value>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </value>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <mutation line0="let sensorMsg = createSensorMsg(&quot;tmp&quot;, 23.4)" numlines="1" declaredvars="sensorMsg"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <field name="LINE0">let sensorMsg = createSensorMsg("tmp", 23.4)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <block type="typescript_statement" editable="false">↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <mutation line0="network_task(sensorMsg)" numlines="1"></mutation>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <field name="LINE0">network_task(sensorMsg)</field>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                                </next>↵                                                                                                                                                                                                              </block>↵                                                                                                                                                                                                            </next>↵                                                                                                                                                                                                          </block>↵                                                                                                                                                                                                        </next>↵                                                                                                                                                                                                      </block>↵                                                                                                                                                                                                    </next>↵                                                                                                                                                                                                  </block>↵                                                                                                                                                                                                </next>↵                                                                                                                                                                                              </block>↵                                                                                                                                                                                            </next>↵                                                                                                                                                                                          </block>↵                                                                                                                                                                                        </next>↵                                                                                                                                                                                      </block>↵                                                                                                                                                                                    </next>↵                                                                                                                                                                                  </block>↵                                                                                                                                                                                </next>↵                                                                                                                                                                              </block>↵                                                                                                                                                                            </next>↵                                                                                                                                                                          </block>↵                                                                                                                                                                        </next>↵                                                                                                                                                                      </block>↵                                                                                                                                                                    </next>↵                                                                                                                                                                  </block>↵                                                                                                                                                                </next>↵                                                                                                                                                              </block>↵                                                                                                                                                            </next>↵                                                                                                                                                          </block>↵                                                                                                                                                        </next>↵                                                                                                                                                      </block>↵                                                                                                                                                    </next>↵                                                                                                                                                  </block>↵                                                                                                                                                </next>↵                                                                                                                                              </block>↵                                                                                                                                            </next>↵                                                                                                                                          </block>↵                                                                                                                                        </next>↵                                                                                                                                      </block>↵                                                                                                                                    </next>↵                                                                                                                                  </block>↵                                                                                                                                </next>↵                                                                                                                              </block>↵                                                                                                                            </next>↵                                                                                                                          </block>↵                                                                                                                        </next>↵                                                                                                                      </block>↵                                                                                                                    </next>↵                                                                                                                  </block>↵                                                                                                                </next>↵                                                                                                              </block>↵                                                                                                            </next>↵                                                                                                          </block>↵                                                                                                        </next>↵                                                                                                      </block>↵                                                                                                    </next>↵                                                                                                  </block>↵                                                                                                </next>↵                                                                                              </block>↵                                                                                            </next>↵                                                                                          </block>↵                                                                                        </next>↵                                                                                      </block>↵                                                                                    </next>↵                                                                                  </block>↵                                                                                </next>↵                                                                              </block>↵                                                                            </next>↵                                                                          </block>↵                                                                        </next>↵                                                                      </block>↵                                                                    </next>↵                                                                  </block>↵                                                                </next>↵                                                              </block>↵                                                            </next>↵                                                          </block>↵                                                        </next>↵                                                      </block>↵                                                    </next>↵                                                  </block>↵                                                </next>↵                                              </block>↵                                            </next>↵                                          </block>↵                                        </next>↵                                      </block>↵                                    </next>↵                                  </block>↵                                </next>↵                              </block>↵                            </next>↵                          </block>↵                        </next>↵                      </block>↵                    </next>↵                  </block>↵                </next>↵              </block>↵            </next>↵          </block>↵        </next>↵      </block>↵    </statement>↵  </block>↵  <block type="procedures_defnoreturn" x="1421" y="0">↵    <field name="NAME">network_setup</field>↵    <field name="PARAMS"></field>↵    <statement name="STACK">↵      <block type="typescript_statement" editable="false">↵        <mutation line0="setup_uart(" line1="        uartContext,  //  Init the context for UART Task." line2="        uartResponse);" numlines="3"></mutation>↵        <field name="LINE0">setup_uart(</field>↵        <field name="LINE1">        uartContext,  //  Init the context for UART Task.</field>↵        <field name="LINE2">        uartResponse);</field>↵        <comment pinned="false" h="120" w="160">Start the Network Task to send and receive network messages. Also starts the UART Task called by the Network Task to send/receive data to the UART port. UART Task must have the highest task priority because it must respond to UART data immediately. Start the UART Task for transmitting UART data to the Wisol module.</comment>↵        <next>↵          <block type="typescript_statement" editable="false">↵            <mutation line0="setup_wisol(" line1="        wisolContext,  //  Init the context for the Network Task." line2="        uartContext," line3="        0," line4="        Country.COUNTRY_SG,  //  Change this to your country code. Affects the Sigfox frequency used." line5="        false);" numlines="6"></mutation>↵            <field name="LINE0">setup_wisol(</field>↵            <field name="LINE1">        wisolContext,  //  Init the context for the Network Task.</field>↵            <field name="LINE2">        uartContext,</field>↵            <field name="LINE3">        0,</field>↵            <field name="LINE4">        Country.COUNTRY_SG,  //  Change this to your country code. Affects the Sigfox frequency used.</field>↵            <field name="LINE5">        false);</field>↵            <comment pinned="false" h="120" w="160">Start the Network Task for receiving sensor data and transmitting to UART Task.</comment>↵          </block>↵        </next>↵      </block>↵    </statement>↵  </block>↵  <block type="procedures_defnoreturn" x="2306" y="0">↵    <field name="NAME">task_open</field>↵    <field name="PARAMS"></field>↵  </block>↵  <block type="procedures_defnoreturn" x="2549" y="0">↵    <field name="NAME">task_close</field>↵    <field name="PARAMS"></field>↵  </block>↵  <block type="procedures_defnoreturn" x="2800" y="0">↵    <field name="NAME">setup_aggregate</field>↵    <field name="PARAMS"></field>↵    <statement name="STACK">↵      <block type="variables_set">↵        <field name="VAR" id="[`2t-(:Z)n~n-gDDj[6Q" variabletype="">sensorData</field>↵        <comment pinned="false" h="120" w="160">Clear the aggregated sensor data.</comment>↵        <value name="VALUE">↵          <shadow type="math_number">↵            <field name="NUM">0</field>↵          </shadow>↵          <block type="lists_create_with">↵            <mutation items="0"></mutation>↵          </block>↵        </value>↵        <next>↵          <block type="controls_repeat_ext">↵            <value name="TIMES">↵              <shadow type="math_whole_number">↵                <field name="NUM">0</field>↵              </shadow>↵              <block type="variables_get">↵                <field name="VAR" id="aK9Izgf;bZZm~HK!TwCc" variabletype="">MAX_SENSOR_COUNT</field>↵              </block>↵            </value>↵            <statement name="DO">↵              <block type="typescript_statement" editable="false">↵                <mutation line0="let sensor: SensorMsg = {" line1="            name: &quot;&quot;," line2="            count: 0," line3="            data: []," line4="        };" numlines="5" declaredvars="sensor"></mutation>↵                <field name="LINE0">let sensor: SensorMsg = {</field>↵                <field name="LINE1">            name: "",</field>↵                <field name="LINE2">            count: 0,</field>↵                <field name="LINE3">            data: [],</field>↵                <field name="LINE4">        };</field>↵                <next>↵                  <block type="array_push">↵                    <value name="list">↵                      <block type="variables_get">↵                        <field name="VAR" id="[`2t-(:Z)n~n-gDDj[6Q" variabletype="">sensorData</field>↵                      </block>↵                    </value>↵                    <value name="value">↵                      <block type="variables_get">↵                        <field name="VAR" id="p4#K7VFf6A@_IR8Rz^sC" variabletype="">sensor</field>↵                      </block>↵                    </value>↵                  </block>↵                </next>↵              </block>↵            </statement>↵          </block>↵        </next>↵      </block>↵    </statement>↵  </block>↵  <block type="procedures_defnoreturn" x="3321" y="0">↵    <field name="NAME">led_toggle</field>↵    <field name="PARAMS"></field>↵    <comment pinned="false" h="120" w="160">/////////////////////////////////////// TODO</comment>↵  </block>↵  <block type="procedures_defnoreturn" x="3605" y="0">↵    <field name="NAME">debug_flush</field>↵    <field name="PARAMS"></field>↵  </block>↵  <block type="device_forever" x="3864" y="0"></block>↵</xml>
